=== PROJECT DUMP FOR CLAUDE ===
Generated: Wed  3 Sep 17:20:35 BST 2025

=== MAIN FILES ===
--- index.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Opening Trainer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #202429; /* Dark Slate Blue */
            --surface-color: #2c313a;
            --border-color: #434853;
            --primary-color: #388dff; /* Vibrant Blue */
            --text-color: #e1e3e6;
            --text-muted-color: #8a919f;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
        }
        .container { max-width: 960px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-weight: 700;
            font-size: 2.5em;
            color: #fff;
            margin-bottom: 40px;
        }
        h1 span { color: var(--primary-color); }
        .course-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        .course-card {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 25px;
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            border-color: var(--primary-color);
        }
        .course-card h2 { margin: 0 0 10px 0; font-size: 1.4em; color: #fff; }
        .course-card p { margin: 0 0 15px 0; color: var(--text-muted-color); font-size: 0.95em; line-height: 1.6; flex-grow: 1; }
        .course-card .author { font-style: italic; font-size: 0.9em; color: #666; }
        .course-card .player-color {
            font-weight: 500;
            color: var(--primary-color);
            text-transform: capitalize;
            text-align: right;
            margin-top: auto;
        }
        #loadingMessage { text-align: center; font-size: 1.2em; color: var(--text-muted-color); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chess Opening <span>Trainer</span></h1>
        <div id="course-list" class="course-list">
            <p id="loadingMessage">Loading courses...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
--- app.js ---
document.addEventListener('DOMContentLoaded', () => {
    const courseListContainer = document.getElementById('course-list');
    const loadingMessage = document.getElementById('loadingMessage');

    async function loadCourses() {
        try {
            const response = await fetch('./data/courses.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const courses = await response.json();
            
            loadingMessage.style.display = 'none';
            displayCourses(courses);

        } catch (error) {
            loadingMessage.textContent = 'Error: Could not load courses. Please check the console for details.';
            console.error('Failed to fetch courses:', error);
        }
    }

    function displayCourses(courses) {
        courseListContainer.innerHTML = ''; // Clear loading message

        courses.forEach(course => {
            const cardLink = document.createElement('a');
            cardLink.href = `trainer.html?course=${course.id}`;
            cardLink.className = 'course-card';

            cardLink.innerHTML = `
                <h2>${course.name}</h2>
                <p>${course.description}</p>
                <p class="author">By: ${course.author}</p>
                <p class="player-color">Play as ${course.playerColor}</p>
            `;
            
            courseListContainer.appendChild(cardLink);
        });
    }

    loadCourses();
});
--- trainer.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Trainer - Enhanced</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono&display=swap" rel="stylesheet">

    <!-- Chessboard CSS (Base and Piece Set) -->
    <link rel="stylesheet" href="./assets/css/chessground.base.css">
    <link rel="stylesheet" href="./assets/css/chessground.chess24.css">
    <link rel="stylesheet" href="./assets/css/chessground.pieces.css">
    <link rel="stylesheet" href="./assets/css/mobile.css">

    <!-- Enhanced App CSS with Dynamic Theming -->
    <link rel="stylesheet" href="./assets/css/styles.css">
    <!-- Third-party Libraries -->
    <script src="./assets/js/chess.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mliebelt/pgn-parser@1.4.18/lib/index.umd.js"></script>
</head>
<body>
    <div id="app-container">
        <header>
            <a href="index.html" class="back-link">‚Üê Courses</a>
            <h1 id="course-title">Loading Course...</h1>
        </header>
        
        <main>
            <div id="board-container" class="theme-chess24">
                <div id="board"></div>
            </div>
            
            <div id="controls-panel">
                <div id="positionInfo" class="control-section">
                    <p id="moveComment" style="font-style: italic; color: #aaa; margin-top: 10px;"></p>
                </div>
                
                <div class="control-section">
                    <div class="control-group">
                        <label for="modeSelect">Mode:</label>
                        <select id="modeSelect">
                            <option value="theory">Theory</option>
                            <option value="exercises">Exercises</option>
                            <option value="spaced_repetition">Spaced Repetition</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="colorSelect">Play as:</label>
                        <select id="colorSelect">
                            <option value="white">White</option>
                            <option value="black">Black</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <div class="control-group">
                        <label id="categoryLabel" for="categorySelect">Category:</label>
                        <select id="categorySelect"></select>
                    </div>
                    <div class="control-group">
                        <label for="lineSelect">Line:</label>
                        <select id="lineSelect"></select>
                    </div>
                    <div class="nav-buttons">
                        <button id="prevLineBtn">‚Äπ Prev</button>
                        <button id="nextLineBtn">Next ‚Ä∫</button>
                    </div>
                </div>

                <div class="control-section action-buttons">
                    <button id="resetBtn">Reset</button>
                    <button id="hintBtn">Hint</button>
                    <button id="flipBtn">Flip Board</button>
                </div>

                <div id="move-navigation" class="control-section nav-buttons">
                    <button id="backBtn">‚Äπ Back</button>
                    <button id="forwardBtn">Forward ‚Ä∫</button>
                </div>

                <div class="status-section">
                    <div class="progress-bar">
                        <div id="progressFill"></div>
                    </div>
                    <div id="status">Ready</div>
                </div>
                <div id="movesList" class="control-section"></div>
            </div>
        </main>
    </div>

    <div id="successMessage" class="feedback-message"></div>
    <div id="errorMessage" class="feedback-message"></div>

    <!-- Main application logic -->
    <script src="trainer.js" type="module"></script>
</body>
</html>
--- trainer.js ---
// Complete working trainer.js - REPLACE YOUR ENTIRE FILE WITH THIS
// This version has all functions properly named and working

import { ChessTrainer } from './engine/trainer-core.js';
import { UIManager } from './engine/ui-manager.js';

document.addEventListener('DOMContentLoaded', () => {
    
    console.log('üöÄ Starting Chess Trainer with PGN Variation Support...');
    
    // Get the course ID from the URL query parameter
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get('course');
    const courseTitleElement = document.getElementById('course-title');

    if (!courseId) {
        courseTitleElement.textContent = 'Error: No course selected!';
        alert('No course ID found in the URL. Please select a course from the homepage.');
        window.location.href = '/index.html';
        return;
    }

    async function initializeTrainer(id) {
        try {
            // Fetch the manifest
            const manifestResponse = await fetch('./data/courses.json');
            if (!manifestResponse.ok) throw new Error('Failed to load course manifest.');
            const courses = await manifestResponse.json();
            const courseInfo = courses.find(c => c.id === id);

            if (!courseInfo) throw new Error(`Course with ID "${id}" not found.`);
            
            // Fetch course data - handle both JSON and PGN
            const courseResponse = await fetch(courseInfo.path);
            if (!courseResponse.ok) throw new Error(`Failed to load course data.`);
            
            let courseData;
            if (courseInfo.path.endsWith('.json')) {
                courseData = await courseResponse.json();
            } else if (courseInfo.path.endsWith('.pgn')) {
                const pgnText = await courseResponse.text();
                console.log('üéØ Parsing PGN with enhanced variation extraction...');
                
                // Use @mliebelt/pgn-parser (browser UMD version)
                const parsed = PgnParser.parse(pgnText, {startRule: "game"});
                
                // Convert to expected course format with ALL variations
                courseData = convertPgnToCourseData(parsed);
                
            } else {
                throw new Error('Unsupported course format');
            }

            // Update page title
            courseTitleElement.textContent = courseData.name;
            console.log('üìö Course loaded:', courseData.name);
            console.log(`   ${courseData.theory.lines.length} lines extracted`);

            // Initialize trainer
            const trainer = new ChessTrainer('board', courseData, {
                defaultColor: courseData.playerColor
            });

            // Initialize UI
            const uiManager = new UIManager(trainer);
            
            // Global access for debugging
            window.trainer = trainer;
            window.uiManager = uiManager;
            
            // Enhanced keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Don't interfere with typing in inputs
                if (e.target.tagName.toLowerCase() === 'input' || e.target.tagName.toLowerCase() === 'select') {
                    return;
                }
                
                switch (e.key.toLowerCase()) {
                    case 'r':
                        if (!e.ctrlKey && !e.metaKey) {
                            trainer.resetPosition();
                            e.preventDefault();
                        }
                        break;
                    case 'f':
                        if (!e.ctrlKey && !e.metaKey) {
                            trainer.flipBoard();
                            e.preventDefault();
                        }
                        break;
                    case 'arrowleft':
                        trainer.previousLine();
                        e.preventDefault();
                        break;
                    case 'arrowright':
                        trainer.nextLine();
                        e.preventDefault();
                        break;
                    case ' ': // Spacebar to toggle standard arrows
                        uiManager.config.multipleArrows = !uiManager.config.multipleArrows;
                        uiManager.refreshArrows();
                        console.log(`Standard arrows ${uiManager.config.multipleArrows ? 'enabled' : 'disabled'}`);
                        e.preventDefault();
                        break;
                    case 'a': // 'A' to toggle PGN annotations
                        if (uiManager.togglePgnAnnotations) {
                            uiManager.togglePgnAnnotations();
                            e.preventDefault();
                        }
                        break;
                }
            });
            
            console.log('‚úÖ Chess Trainer with PGN variations initialized successfully!');
            
        } catch (error) {
            courseTitleElement.textContent = 'Error loading course!';
            console.error('‚ùå Initialization failed:', error);
            alert(`Error: ${error.message}`);
        }
    }

    // Start the application
    initializeTrainer(courseId);

    // Enhanced debug commands
    console.log(`
    üéØ Chess Trainer Debug Commands:
    - window.trainer: Access trainer
    - window.uiManager: Access UI manager  
    - uiManager.refreshArrows(): Force refresh arrows
    - uiManager.togglePgnAnnotations(): Toggle PGN annotation arrows
    - trainer.getCurrentLine(): See current line data
    - trainer.getCurrentLine().annotations: See PGN annotations
    
    Keyboard shortcuts:
    - R: Reset position
    - F: Flip board
    - ‚Üê/‚Üí: Previous/Next line
    - Space: Toggle standard arrows (green/yellow/blue)
    - A: Toggle PGN annotation arrows (pale colors)
    `);
});

/**
 * Convert PGN to Course Data - SIMPLE, WORKING VERSION
 */
function convertPgnToCourseData(parsed) {
    console.log('üìö Converting PGN to course data...');
    
    const courseData = {
        name: parsed.tags.Event || parsed.tags.Opening || 'PGN Course',
        author: parsed.tags.White || parsed.tags.Black || 'Unknown',
        description: parsed.tags.Annotator || 'Imported from PGN',
        playerColor: determinePlayerColor(parsed.tags),
        orientation: determinePlayerColor(parsed.tags),
        theory: {
            startingFen: parsed.tags.FEN || null,
            lines: []
        }
    };

    // Simple extraction: main line + variations
    const allLines = extractAllLines(parsed.moves, parsed.tags);
    courseData.theory.lines = allLines;
    
    console.log(`‚úÖ Extracted ${allLines.length} lines from PGN:`);
    allLines.forEach((line, i) => {
        console.log(`   ${i + 1}. ${line.name} (${line.moves.length} moves)`);
        if (line.annotations) {
            console.log(`      üìç ${line.annotations.arrows.length} arrows, ${line.annotations.highlights.length} highlights`);
        }
    });
    
    return courseData;
}

/**
 * Extract all lines - main line + variations
 */
function extractAllLines(moves, tags = {}) {
    const allLines = [];
    
    // 1. Extract main line
    const mainLine = extractMainLine(moves, tags);
    if (mainLine.moves.length > 0) {
        allLines.push(mainLine);
    }
    
    // 2. Extract variations
    const variations = extractVariations(moves, tags);
    allLines.push(...variations);
    
    return allLines;
}

/**
 * Extract the main line (just the main moves, no variations)
 */
function extractMainLine(moves, tags) {
    const mainMoves = [];
    const mainComments = [];
    
    for (const move of moves) {
        const moveNotation = extractMoveNotation(move);
        if (moveNotation) {
            mainMoves.push(moveNotation);
            mainComments.push(extractComment(move) || '');
        }
    }
    
    return {
        name: tags.Opening || tags.Event || 'Main Line',
        description: tags.Annotator || 'Main line from PGN',
        category: tags.ECO || 'Main Lines',
        moves: mainMoves,
        comments: mainComments,
        annotations: extractAnnotations(moves)
    };
}

/**
 * Extract all variations recursively - FIXED VERSION
 */
function extractVariations(moves, tags = {}, depth = 0, parentMoves = []) {
    const variations = [];
    let variationCounter = 1;
    
    for (let i = 0; i < moves.length; i++) {
        const move = moves[i];
        
        if (move.variations && Array.isArray(move.variations) && move.variations.length > 0) {
            
            // Build the position up to this point
            const positionMoves = [...parentMoves];
            for (let j = 0; j < i; j++) {
                const moveNotation = extractMoveNotation(moves[j]);
                if (moveNotation) {
                    positionMoves.push(moveNotation);
                }
            }
            
            for (const variation of move.variations) {
                if (variation && Array.isArray(variation) && variation.length > 0) {
                    
                    // Build variation line
                    const variationMoves = [];
                    const variationComments = [];
                    
                    // Add position moves
                    positionMoves.forEach(move => {
                        variationMoves.push(move);
                        variationComments.push('');
                    });
                    
                    // Add variation moves
                    for (const varMove of variation) {
                        const moveNotation = extractMoveNotation(varMove);
                        if (moveNotation) {
                            variationMoves.push(moveNotation);
                            variationComments.push(extractComment(varMove) || '');
                        }
                    }
                    
                    // Validate the move sequence
                    if (validateMoveSequence(variationMoves)) {
                        const variationLine = {
                            name: generateVariationName(variation, variationCounter, tags, depth),
                            description: `Variation ${variationCounter}${depth > 0 ? ` (depth ${depth})` : ''}`,
                            category: determineVariationCategory(variation, tags),
                            moves: variationMoves,
                            comments: variationComments,
                            annotations: extractAnnotations(variation),
                            variationInfo: {
                                branchPoint: positionMoves.length,
                                depth: depth,
                                number: variationCounter
                            }
                        };
                        
                        variations.push(variationLine);
                        
                        // Recursively extract sub-variations
                        const subVariations = extractVariations(variation, tags, depth + 1, variationMoves);
                        variations.push(...subVariations);
                    } else {
                        console.warn(`‚ö†Ô∏è Skipping invalid variation ${variationCounter} - invalid move sequence`);
                    }
                    
                    variationCounter++;
                }
            }
        }
    }
    
    return variations;
}

/**
 * Validate a move sequence
 */
function validateMoveSequence(moves) {
    if (!moves || moves.length === 0) return true;
    
    try {
        const testBoard = new Chess();
        
        for (const move of moves) {
            const result = testBoard.move(move, { sloppy: true });
            if (!result) {
                return false;
            }
        }
        
        return true;
    } catch (error) {
        return false;
    }
}

/**
 * Extract move notation from various formats
 */
function extractMoveNotation(move) {
    if (!move) return null;
    
    if (typeof move === 'string') {
        return move;
    }
    
    if (move.notation) {
        return move.notation.notation || 
               move.notation.san || 
               move.notation.move || 
               move.notation;
    }
    
    return move.san || move.move || move.toString();
}

/**
 * Extract comments from move
 */
function extractComment(move) {
    if (!move) return '';
    
    let comment = '';
    
    if (move.commentAfter) comment += move.commentAfter;
    if (move.comment) comment += (comment ? ' ' : '') + move.comment;
    if (move.commentBefore) comment += (comment ? ' ' : '') + move.commentBefore;
    
    return comment.trim();
}

/**
 * Extract annotations like [%cal] for arrows
 */
function extractAnnotations(moves) {
    const annotations = {
        arrows: [],
        highlights: [],
        comments: []
    };
    
    for (const move of moves) {
        const comment = extractComment(move);
        if (!comment) continue;
        
        // Extract [%cal] arrow annotations
        const calMatches = comment.match(/\[%cal\s+([^\]]+)\]/gi);
        if (calMatches) {
            for (const match of calMatches) {
                const arrowData = match.replace(/\[%cal\s+/gi, '').replace(/\]/g, '');
                const arrows = parseCalAnnotation(arrowData);
                annotations.arrows.push(...arrows);
            }
        }
        
        // Extract [%csl] highlight annotations  
        const cslMatches = comment.match(/\[%csl\s+([^\]]+)\]/gi);
        if (cslMatches) {
            for (const match of cslMatches) {
                const highlightData = match.replace(/\[%csl\s+/gi, '').replace(/\]/g, '');
                const highlights = parseCslAnnotation(highlightData);
                annotations.highlights.push(...highlights);
            }
        }
        
        // Store clean comment
        const cleanComment = comment
            .replace(/\[%cal\s+[^\]]+\]/gi, '')
            .replace(/\[%csl\s+[^\]]+\]/gi, '')
            .trim();
            
        if (cleanComment) {
            annotations.comments.push(cleanComment);
        }
    }
    
    return annotations;
}

/**
 * Parse [%cal] arrow annotations
 */
function parseCalAnnotation(calData) {
    const arrows = [];
    
    if (!calData || typeof calData !== 'string') {
        return arrows;
    }
    
    const arrowSpecs = calData.split(',');
    
    for (const spec of arrowSpecs) {
        const trimmed = spec.trim();
        
        // Parse format like "Ge2e4" 
        const match = trimmed.match(/([GRYBOWP])([a-h][1-8])([a-h][1-8])/i);
        
        if (match) {
            const [, color, from, to] = match;
            
            arrows.push({
                from: from.toLowerCase(),
                to: to.toLowerCase(),
                color: mapAnnotationColor(color)
            });
        }
    }
    
    return arrows;
}

/**
 * Parse [%csl] square highlight annotations
 */
function parseCslAnnotation(cslData) {
    const highlights = [];
    const highlightSpecs = cslData.split(',');
    
    for (const spec of highlightSpecs) {
        const trimmed = spec.trim();
        if (trimmed.length >= 3) {
            const color = trimmed[0];
            const square = trimmed.slice(1, 3);
            
            highlights.push({
                square: square,
                color: mapAnnotationColor(color)
            });
        }
    }
    
    return highlights;
}

/**
 * Map annotation color codes
 */
function mapAnnotationColor(colorCode) {
    const colorMap = {
        'G': 'green',
        'R': 'red', 
        'Y': 'yellow',
        'B': 'blue',
        'O': 'orange'
    };
    
    return colorMap[colorCode.toUpperCase()] || 'green';
}

/**
 * Generate meaningful variation names
 */
function generateVariationName(variation, varNum, tags, depth) {
    if (variation.length > 0) {
        const firstComment = extractComment(variation[0]);
        if (firstComment) {
            const cleanComment = firstComment
                .replace(/\[%cal\s+[^\]]+\]/gi, '')
                .replace(/\[%csl\s+[^\]]+\]/gi, '')
                .trim();
            
            // Look for patterns like "Hungarian Defense" or "Rousseau Gambit"
            const patterns = [
                /(?:The\s+)?([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*?\s+(?:Defense|Attack|Gambit|System|Line|Variation))/i,
                /([A-Z][a-z]+\s+(?:Gambit|Defense|Attack|System|Line))/i,
                /^([A-Z][^.!?\[\]]{3,40}?)(?:[.!?\[]|$)/
            ];
            
            for (const pattern of patterns) {
                const match = cleanComment.match(pattern);
                if (match && match[1]) {
                    const name = match[1].trim().replace(/[.!?]+$/, '');
                    return `Variation ${varNum}: ${name}`;
                }
            }
        }
        
        // Fallback: use first moves
        const firstMoves = variation.slice(0, 2)
            .map(extractMoveNotation)
            .filter(Boolean)
            .join(' ');
        
        if (firstMoves) {
            return `Variation ${varNum}: ${firstMoves}`;
        }
    }
    
    return `Variation ${varNum}`;
}

/**
 * Determine variation category
 */
function determineVariationCategory(variation, tags) {
    const comment = variation.length > 0 ? extractComment(variation[0]) : '';
    
    const categoryKeywords = {
        'Defense': ['Defense', 'Defensive'],
        'Attack': ['Attack', 'Attacking', 'Aggressive'], 
        'Gambit': ['Gambit'],
        'Trap': ['Trap', 'Tricky'],
        'Endgame': ['Endgame', 'Ending'],
        'Opening': ['Opening', 'Debut']
    };
    
    for (const [category, keywords] of Object.entries(categoryKeywords)) {
        if (keywords.some(keyword => comment.includes(keyword))) {
            return category;
        }
    }
    
    return tags.ECO || 'Variations';
}

/**
 * Determine player color from PGN tags
 */
function determinePlayerColor(tags) {
    if (tags.White && tags.White.toLowerCase().includes('student')) return 'white';
    if (tags.Black && tags.Black.toLowerCase().includes('student')) return 'black';
    return 'white';
}
=== DATA FILES ===
--- data/courses.json ---
[
    {
        "id": "e4-repertoire-white",
        "name": "Complete 1.e4 Repertoire for White",
        "author": "IM Andras Toth",
        "description": "A comprehensive repertoire for White starting with 1.e4, covering responses to the Petrov, Scandinavian, French, and more.",
        "playerColor": "white",
        "path": "data/e4-repertoire.json"
    },
    {
        "id": "traxler-counter-attack",
        "name": "Traxler Counter-Attack",
        "author": "Community",
        "description": "An aggressive and tactical counter-attacking system for Black against the Italian Game's Fried Liver Attack.",
        "playerColor": "black",
        "path": "./data/traxler.json"
    },
    {
        "id": "italian-toth",
        "name": "Italian Game: Giuoco Pianissimo & Tricky Gambits",
        "author": "Community",
        "description": "An aggressive introduction to the Italian Game, focusing on the Giuoco Piano and Evans Gambit.",
        "playerColor": "white",
        "path": "./data/italian-toth.json"
    },
    {
        "id": "italian-variations-test",
        "name": "Italian Game: Variations Study (PGN Test)",
        "author": "Chess Trainer",
        "description": "Test course for PGN variation extraction with [%cal] arrows and multiple lines",
        "playerColor": "white",
        "path": "./data/italian-variations-test.pgn"
    },
    {
  "id": "ultra-simple",
  "name": "Ultra Simple Test", 
  "playerColor": "white",
  "path": "./data/ultra-simple.pgn"
    }
]
--- data/e4-repertoire.json ---
{
  "name": "Winning 1.e4 Repertoire - Scandinavian Module",
  "author": "IM Andras Toth / colt45nine",
  "description": "The complete Scandinavian Defense lines from the PGN study, with all variations as separate lines.",
  "playerColor": "white",
  "orientation": "white",
  "theory": {
    "startingFen": null,
    "lines": [
       {
        "name": "Scandinavian: Introduction",
        "description": "Side variation from the introduction chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "Main Line"]
      },     
       {
        "name": "Scandinavian: Main Line, Mieses Variation (3...Qa5)",
        "description": "Main line against the Mieses Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5", "d4", "Nf6", "Nf3", "c6", "Bd2", "Bg4", "h3", "Bh5", "g4", "Bg6", "Ne5", "Nbd7", "f4", "e6", "h4", "Nxe5"],
        "comments": ["", "", "", "", "", "", "", "", "", "", "We eliminate the pin...", "", "", "", "bishop have no time to breath", "", "Our standard knight move.", "", "", "", "The black bishop on g6 is experiencing extreme discomfort.", ""]
      },

      {
        "name": "Scandinavian: Modern, Richter Variation (2...Nf6)",
        "description": "Against the Portuguese Gambit line of the Scandinavian.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Nf6", "d4", "Nxd5", "Nf3", "g6", "c4", "Nb6", "Nc3", "Bg7", "c5", "Nd5", "Bc4", "Nxc3", "bxc3", "O-O", "O-O", "b6", "Re1", "bxc5", "Ng5", "e6", "Qf3", "c6", "Qh3", "h6", "Ne4"],
        "comments": ["", "This move introduces the Scandinavian Defense...", "", "This move introduces the Portuguese Gambit...", "White simply gets on with their usual agendas...", "Marshall variation", "", "Richter Variation", "This natural space grab is our bread and butter...", "", "", "", "At first, this move is a positional mistake...", "", "", "", "", "", "", "", "This is a very important move to remember...", "", "Although12.Bg5 is also a good move here...", "", "", "", "", "", "White has a dominant position with fabulous attacking prospects."]
      },
      {
        "name": "Scandinavian: Anderssen Counterattack (3...Qe6+)",
        "description": "Side variation from the introduction chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qe6+", "Be2", "Nc6", "d4", "Qf5", "Nb5", "Qd7", "Bf4", "e5", "dxe5", "Bb4+"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "most played but is mistake", "", "", "", "", "", "", "the only move", ""]
      },
      {
        "name": "Scandinavian: Anderssen Counterattack (Side: vs 7.d5)",
        "description": "Side variation within the 3...Qe6+ line.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qe6+", "Be2", "Nc6", "d4", "Qf5", "Nb5", "Qd7", "d5", "Nb8", "Bf4", "Na6", "Qd4", "Nf6", "O-O-O"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "most played but is mistake", "", "", "", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Valencian Variation (3...Qd8)",
        "description": "Main line vs the Valencian Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qd8", "d4", "Nf6", "Bg5", "Nbd7", "Bc4", "Be7", "O-O", "a6", "a4", "c5", "dxc5", "Bxc5", "Ne4", "Be7", "Nd6+", "Bxd6", "Qxd6", "Ne4", "Qf4", "Nxg5", "Nxg5", "Nf6", "Rad1", "Bd7", "Rfe1", "Qb8", "Qh4", "Qc7", "Rd3", "h6", "Rg3", "O-O", "Nf3", "Kh8"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "almost 40% Valencian Variation", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Valencian Variation (Side: vs 4...Nc6)",
        "description": "Side variation within the Valencian Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qd8", "d4", "Nc6", "d5", "Nb8", "Bc4", "e5", "Qe2", "Nd7", "f4", "Bd6", "Nf3", "Qe7", "O-O", "Ngf6", "Re1", "e4", "Nxe4", "O-O", "Nxd6", "Qxd6", "Qf2"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "", "", "", "", "so many bad move that doesnt look bad for black ... only 6...e5! is not loosing", "", "", "", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Valencian Variation (Side: vs 4...g6)",
        "description": "Side variation within the Valencian Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qd8", "d4", "g6", "Nf3", "Bg7", "Be3", "Nf6", "Qd2", "O-O", "O-O-O"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "", "", "", "", "", "", "", "this is good for white ..Black has too many theories1 to know!"]
      },
      {
        "name": "Scandinavian: Valencian Variation (Side: vs 4...e6)",
        "description": "Side variation within the Valencian Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qd8", "d4", "e6", "Nf3", "Nf6", "Bc4"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Valencian, Ilundain Variation (4...c6)",
        "description": "Side variation within the Valencian Variation.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qd8", "d4", "c6", "Bc4", "Nf6", "Nf3", "b5"],
        "comments": ["", "The Scandinavian is a great opening for the active Black player...", "", "Scandinavian Defense: Mieses-Kotroc Variation", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Mieses Variation (Side: vs 11...Nd5)",
        "description": "Side variation from the Mieses chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5", "d4", "Nf6", "Nf3", "c6", "Bd2", "Bg4", "h3", "Bh5", "g4", "Bg6", "Ne5", "Nbd7", "f4", "e6", "h4", "Nd5", "Nxd7", "Kxd7", "Bg2", "Nxc3", "Bxc3", "Bb4", "Bxb4", "Qxb4+"],
        "comments": ["", "", "", "", "", "", "", "", "", "", "We eliminate the pin...", "", "", "", "bishop have no time to breath", "", "Our standard knight move.", "", "", "", "The black bishop on g6 is experiencing extreme discomfort.", "", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Mieses Variation (Side: vs 11...h6)",
        "description": "Side variation from the Mieses chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5", "d4", "Nf6", "Nf3", "c6", "Bd2", "Bg4", "h3", "Bh5", "g4", "Bg6", "Ne5", "Nbd7", "f4", "e6", "h4", "h6", "Nxg6", "fxg6", "Bc4", "O-O-O", "Qe2"],
        "comments": ["", "", "", "", "", "", "", "", "", "", "We eliminate the pin...", "", "", "", "bishop have no time to breath", "", "Our standard knight move.", "", "", "", "The black bishop on g6 is experiencing extreme discomfort.", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Mieses Variation (Side: vs 11...h5)",
        "description": "Side variation from the Mieses chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5", "d4", "Nf6", "Nf3", "c6", "Bd2", "Bg4", "h3", "Bh5", "g4", "Bg6", "Ne5", "Nbd7", "f4", "e6", "h4", "h5", "Nxg6", "fxg6", "g5", "Nd5", "Bg2", "Nxc3", "bxc3"],
        "comments": ["", "", "", "", "", "", "", "", "", "", "We eliminate the pin...", "", "", "", "bishop have no time to breath", "", "Our standard knight move.", "", "", "", "The black bishop on g6 is experiencing extreme discomfort.", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Scandinavian: Mieses Variation (Side: vs 11...Bb4)",
        "description": "Side variation from the Mieses chapter.",
        "category": "Scandinavian Defense",
        "moves": ["e4", "d5", "exd5", "Qxd5", "Nc3", "Qa5", "d4", "Nf6", "Nf3", "c6", "Bd2", "Bg4", "h3", "Bh5", "g4", "Bg6", "Ne5", "Nbd7", "f4", "e6", "h4", "Bb4", "h5", "Bxc3", "Bxc3", "Qd5", "hxg6", "Qxh1"],
        "comments": ["", "", "", "", "", "", "", "", "", "", "We eliminate the pin...", "", "", "", "bishop have no time to breath", "", "Our standard knight move.", "", "", "", "The black bishop on g6 is experiencing extreme discomfort.", "", "", "", "", "", "", ""]
      },
      {
        "name": "Petrov Defense: Nimzowitsch Attack (Main Line)",
        "description": "An active approach against the solid Petrov Defense.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "Nxe5", "d6", "Nf3", "Nxe4", "Nc3", "Nxc3", "dxc3", "Be7", "Be3", "Nc6", "Qd2", "Be6", "O-O-O", "Qd7", "Kb1", "Bf6", "h4", "O-O-O", "Nd4", "Nxd4", "Bxd4", "Bxd4", "Qxd4"],
        "comments": ["","","","This move introduces the Petrov Defense...","The most popular move and the most principled one...","","","","This is the second most popular move...","","The right recapture...","By far the most popular move...","White's main goal in this system is to quickly castle queenside...","7...d5 is too early here...","White consistently carries out the intention...","The bishop is annoyingly aiming at a2...","Anyway! It turns out that the a2-pawn is poisoned!","Black floats the possibility of castling either side...","Simply securing the a2-pawn...","","This is a typical method we use to begin a kingside attack...","","This is an important move to remember!","","","","And White has the upper hand..."]
      },
      {
        "name": "Petrov Defense: Three Knights Game (Side)",
        "description": "Side variation from the Petrov chapter.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "Nc3"],
        "comments": ["","","","", "Black can easily transpose into the Four Knights Game with 3...Nc6..."]
      },
      {
        "name": "Petrov Defense: Steinitz Variation (Side)",
        "description": "Side variation from the Petrov chapter.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "d4", "Nxe4", "Bd3", "d5", "Nxe5", "Nd7", "Nxd7", "Bxd7", "O-O", "Bd6", "c4", "c6", "cxd5", "cxd5", "Nc3", "Nxc3", "bxc3", "O-O", "Qh5", "g6", "Qxd5", "Qc7"],
        "comments": ["","","","", "Modern or Steinitz variation...", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
      },
      {
        "name": "Petrov Defense: Cochrane Gambit (Side)",
        "description": "Side variation from the Petrov chapter.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "Nxe5", "d6", "Nxf7", "Kxf7", "d4", "c5", "Nc3", "cxd4", "Bc4+", "d5", "Nxd5", "Be6", "Bg5", "Nbd7", "O-O", "Qc8", "Nxf6", "Qxc4", "Qh5+", "g6", "Qf3", "Nxf6", "Bxf6", "Bg7", "Bxd4+", "Kg8", "Bxg7", "Kxg7", "b3", "Qc5", "Rad1", "Rhd8", "c4", "Qe5", "h3", "Rxd1", "Rxd1"],
        "comments": ["","","","","","","There are a few lines that are quite dangerous...","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Petrov Defense: Nimzowitsch (Side: Poisoned a2 pawn)",
        "description": "Side variation from the Petrov chapter.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "Nxe5", "d6", "Nf3", "Nxe4", "Nc3", "Nxc3", "dxc3", "Be7", "Be3", "Nc6", "Qd2", "Be6", "O-O-O", "Bxa2", "b3", "a5", "Kb2", "a4", "Ra1", "axb3", "cxb3", "Bxb3", "Rxa8", "Qxa8", "Kxb3", "Qa1", "Qb2", "Qd1+", "Qc2", "Qa1", "Qc1", "Na5+", "Kc2", "Qa4+", "Kb1", "Nc4", "Bxc4", "Qxc4", "Qa3", "O-O", "Kc2", "Qe4+", "Kd2", "Qd5+", "Kc2", "Qe4+", "Kc1", "d5", "Qb3", "Ra8", "Kd2", "c6", "Rc1", "b5", "Ke2", "Ra3", "Qc2", "Qc4+", "Qd3", "Qxd3+", "Kxd3", "b4", "Nd4", "c5", "Nb5"],
        "comments": ["","","","","","","","","","","","","","","","","","","go to sleep bishop","","","","","","","","","","","","the only good move here","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","WAS THE ONLY GOOD MOVE","",""]
      },
      {
        "name": "Petrov Defense: OTB Game Example",
        "description": "An example game vs the Russian Game.",
        "category": "Petrov Defense",
        "moves": ["e4", "e5", "Nf3", "Nf6", "Nxe5", "Qe7", "Nf3", "d6", "Qe2", "Qxe4", "Qxe4+", "Nxe4", "d4", "Nc6", "Bb5", "Bd7", "Be3", "O-O-O", "a4", "Kb8", "O-O", "Nb4", "Na3", "a6", "Bc4", "f6", "d5", "Bxa4", "c3", "Nc2", "Nxc2", "Bxc2", "Nd4", "b5", "Rxa6", "bxc4", "Nc6+", "Kc8", "Ra8+", "Kb7", "Rxd8"],
        "comments": ["","","","","","Inaccuracy. d6 was best.","10000 players+ played 4...d6...","Blunder. Nxe4 was best.","I have to admit I played too fast there...","","","position back to =...","","","","","","","","","","","","","Inaccuracy. Bxd7 was best.","Mistake. Bxa4 was best.","","Blunder. c6 was best.","","Inaccuracy. b5 was best.","","","","Inaccuracy. Nxc3 was best.","","Checkmate is now unavoidable...","","","","","",""]
      },
      {
        "name": "Caro-Kann: Bronstein-Larsen (Main Line)",
        "description": "Facing the ...gxf6 line in the Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nf6", "Nxf6+", "gxf6", "Nf3", "Bg4", "Be2", "e6", "O-O", "Qc7", "c4", "Nd7", "Nh4", "Bxe2", "Qxe2", "O-O-O", "d5", "exd5", "cxd5", "cxd5", "Be3"],
        "comments": ["","","","","","","","This move leads to two very different positions...","","With this quirky move Black takes several risks...","Unlike in the system with exf6...","Against such pins our gut reaction is always to kick the bishop immediately...","The text move breaks the pin...","","The g-file attack is nothing more than an illusion...","","","","This unusual move here has multiple benefits...","","","","This central break is the key idea!","","","","And White has a tremendous attacking position..."]
      },
      {
        "name": "Caro-Kann: Bronstein-Larsen (Side: vs 7.h3?)",
        "description": "Side variation from the Bronstein-Larsen chapter.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nf6", "Nxf6+", "gxf6", "Nf3", "Bg4", "h3", "Bxf3", "Qxf3", "Qxd4", "Be2", "Nd7", "O-O", "Ne5"],
        "comments": ["","","","","","","","","","", "", "", "","Bxf3!","","","THIS WAY WHITE IS UNDEVELOPED...","","","",""]
      },
      {
        "name": "Caro-Kann: Karpov Variation Trap",
        "description": "An aggressive trap in the Karpov Variation.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nd7", "Ng5", "h6", "Ne6", "Qa5+", "Bd2", "Qb6", "Bd3", "fxe6", "Qh5+", "Kd8", "Ba5"],
        "comments": ["","","","","","","","This line is called the Karpov Variation...","An unorthodox move in return...","This is a common mistake here...","This knight sortie is one of the key ideas...","This leads to a famous opening trap.","","","White can still leave the knight hanging!","","","","This stunning geometrical motif decides the game. The queen is lost!"]
      },
      {
        "name": "Caro-Kann: Classical, Lobron System",
        "description": "A solid, strategic approach against the Classical Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Bf5", "Ng3", "Bg6", "h4", "h6", "h5", "Bh7", "Nf3", "e6", "Bd3", "Bxd3", "Qxd3", "Nd7", "Bd2", "Ngf6", "O-O-O", "Be7", "Qe2", "O-O", "Nf1"],
        "comments": ["","This move introduces the Caro-Kann Defense...","As always, when given the chance...","","The most thematic response...","","","The vast majority of times, black plays the solid 3...dxe4...","","","This move tickles the bishop...","","This pawn thrust has a long-term benefit too...","","","","The active 'Capablanca bishop' needs to be dealt with.","","","","","11.Bf4 is also possible here...","","","","This useful move removes the queen from the d-file...","","With Black having committed to opposite side castling, we adjust our plans!"]
      },
      {
        "name": "Caro-Kann: Von Hennig Gambit",
        "description": "An aggressive gambit line against the Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Bc4", "Nf6", "f3", "h6", "fxe4", "Bg4", "Nf3", "Bxf3", "gxf3", "e6", "Bd2", "Nh5", "Qe2", "Be7", "O-O-O", "g5", "d5", "Bd6", "e5", "Bc5", "dxe6", "fxe6", "f4", "Nxf4", "Bxf4", "Nd7", "Qh5+", "Kf8", "Bxe6", "gxf4"],
        "comments": ["","","","Caro-Kann. I don't have any knowledge of the theory...","","","I see a chance to gambit a pawn...","","","","I don't see the point of h6...","","","","Really pleased with that exchange...","","My mouse slipped here...","They don't take the pawn...","I develop my queen and get ready to castle...","Their get a queen-bishop battery going on h5...","Finally developed! Time to rip it open and attack.","Terrible. Their position was probably already lost...","","","Perhaps this is not the strongest move here...","A bad move, but there aren't really any good moves left...","","","Driving their knight backwards...","A huge blunder, and apparently they realized it.","","","","","",""]
      },
            {
        "name": "Caro-Kann: Bronstein-Larsen (Main Line)",
        "description": "Facing the ...gxf6 line in the Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nf6", "Nxf6+", "gxf6", "Nf3", "Bg4", "Be2", "e6", "O-O", "Qc7", "c4", "Nd7", "Nh4", "Bxe2", "Qxe2", "O-O-O", "d5", "exd5", "cxd5", "cxd5", "Be3"],
        "comments": ["","","","","","","","This move leads to two very different positions...","","With this quirky move Black takes several risks...","Unlike in the system with exf6...","Against such pins our gut reaction is always to kick the bishop immediately...","The text move breaks the pin...","","The g-file attack is nothing more than an illusion...","","","","This unusual move here has multiple benefits...","","","","This central break is the key idea!","","","","And White has a tremendous attacking position..."]
      },
      {
        "name": "Caro-Kann: Bronstein-Larsen (Side: vs 7.h3?)",
        "description": "Side variation from the Bronstein-Larsen chapter.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nf6", "Nxf6+", "gxf6", "Nf3", "Bg4", "h3", "Bxf3", "Qxf3", "Qxd4", "Be2", "Nd7", "O-O", "Ne5"],
        "comments": ["","","","","","","","","","", "", "", "","Bxf3!","","","THIS WAY WHITE IS UNDEVELOPED...","","","",""]
      },
      {
        "name": "Caro-Kann: Karpov Variation Trap",
        "description": "An aggressive trap in the Karpov Variation.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Nd7", "Ng5", "h6", "Ne6", "Qa5+", "Bd2", "Qb6", "Bd3", "fxe6", "Qh5+", "Kd8", "Ba5"],
        "comments": ["","","","","","","","This line is called the Karpov Variation...","An unorthodox move in return...","This is a common mistake here...","This knight sortie is one of the key ideas...","This leads to a famous opening trap.","","","White can still leave the knight hanging!","","","","This stunning geometrical motif decides the game. The queen is lost!"]
      },
      {
        "name": "Caro-Kann: Classical, Lobron System",
        "description": "A solid, strategic approach against the Classical Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Nxe4", "Bf5", "Ng3", "Bg6", "h4", "h6", "h5", "Bh7", "Nf3", "e6", "Bd3", "Bxd3", "Qxd3", "Nd7", "Bd2", "Ngf6", "O-O-O", "Be7", "Qe2", "O-O", "Nf1"],
        "comments": ["","This move introduces the Caro-Kann Defense...","As always, when given the chance...","","The most thematic response...","","","The vast majority of times, black plays the solid 3...dxe4...","","","This move tickles the bishop...","","This pawn thrust has a long-term benefit too...","","","","The active 'Capablanca bishop' needs to be dealt with.","","","","","11.Bf4 is also possible here...","","","","This useful move removes the queen from the d-file...","","With Black having committed to opposite side castling, we adjust our plans!"]
      },
      {
        "name": "Caro-Kann: Von Hennig Gambit",
        "description": "An aggressive gambit line against the Caro-Kann.",
        "category": "Caro-Kann Defense",
        "moves": ["e4", "c6", "d4", "d5", "Nc3", "dxe4", "Bc4", "Nf6", "f3", "h6", "fxe4", "Bg4", "Nf3", "Bxf3", "gxf3", "e6", "Bd2", "Nh5", "Qe2", "Be7", "O-O-O", "g5", "d5", "Bd6", "e5", "Bc5", "dxe6", "fxe6", "f4", "Nxf4", "Bxf4", "Nd7", "Qh5+", "Kf8", "Bxe6", "gxf4"],
        "comments": ["","","","Caro-Kann. I don't have any knowledge of the theory...","","","I see a chance to gambit a pawn...","","","","I don't see the point of h6...","","","","Really pleased with that exchange...","","My mouse slipped here...","They don't take the pawn...","I develop my queen and get ready to castle...","Their get a queen-bishop battery going on h5...","Finally developed! Time to rip it open and attack.","Terrible. Their position was probably already lost...","","","Perhaps this is not the strongest move here...","A bad move, but there aren't really any good moves left...","","","Driving their knight backwards...","A huge blunder, and apparently they realized it.","","","","","",""]
      },
      {
        "name": "French Defense: Advance, Paulsen Attack",
        "description": "Example game vs the most played moves in the French Advance.",
        "category": "French Defense",
        "moves": ["e4", "e6", "d4", "d5", "e5", "c5", "c3", "Nc6", "Nf3", "Qb6", "Be2", "cxd4", "cxd4", "Nge7", "O-O", "Nf5", "Nc3", "Nfxd4", "Nxd4", "Nxd4", "Be3", "Nxe2+", "Qxe2", "Qc7", "a3"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","Black following with a mistake in 1 game on 2 :D"]
      },
      {
        "name": "French Defense: Paulsen Attack (Side: vs 13.f4)",
        "description": "Side variation from the French Defense chapter.",
        "category": "French Defense",
        "moves": ["e4", "e6", "d4", "d5", "e5", "c5", "c3", "Nc6", "Nf3", "Qb6", "Be2", "cxd4", "cxd4", "Nge7", "O-O", "Nf5", "Nc3", "Nfxd4", "Nxd4", "Nxd4", "Be3", "Nxe2+", "Qxe2", "Qc7", "f4", "Bc5", "Bxc5", "Qxc5+", "Kh1", "O-O", "Nb5", "Bd7", "Nd6"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "French Defense: Paulsen Attack (Side: vs 13...Qxe5?)",
        "description": "Side variation from the French Defense chapter.",
        "category": "French Defense",
        "moves": ["e4", "e6", "d4", "d5", "e5", "c5", "c3", "Nc6", "Nf3", "Qb6", "Be2", "cxd4", "cxd4", "Nge7", "O-O", "Nf5", "Nc3", "Nfxd4", "Nxd4", "Nxd4", "Be3", "Nxe2+", "Qxe2", "Qc7", "a3", "Qxe5", "f4", "Qb8", "Bd4", "b6", "f5", "Qc7", "Na4"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","as long we dont play that White is in great shape","","","many strong moves that can only stinks for Black","","AGAIN THIS WAS NEEDED","",""]
      },
      {
        "name": "French Defense: Paulsen Attack (Side: vs 14...Qc7?)",
        "description": "Side variation from the French Defense chapter.",
        "category": "French Defense",
        "moves": ["e4", "e6", "d4", "d5", "e5", "c5", "c3", "Nc6", "Nf3", "Qb6", "Be2", "cxd4", "cxd4", "Nge7", "O-O", "Nf5", "Nc3", "Nfxd4", "Nxd4", "Nxd4", "Be3", "Nxe2+", "Qxe2", "Qc7", "a3", "Qxe5", "f4", "Qc7", "Rac1", "Qd7", "Nb5", "Bd6", "Nxd6+", "Qxd6", "Bc5", "Qd8", "f5", "h5", "fxe6", "Bxe6", "Qe5", "Rh7", "Rce1", "Qd7", "Qxe6+", "fxe6", "Rf8#"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","AGAIN THIS WAS NEEDED","","","","","","","LEADS TO EAS FORCED MATE","",""]
      },
      {
        "name": "French Defense: Paulsen Attack (Side: vs 19.Qg4?)",
        "description": "Side variation from the French Defense chapter.",
        "category": "French Defense",
        "moves": ["e4", "e6", "d4", "d5", "e5", "c5", "c3", "Nc6", "Nf3", "Qb6", "Be2", "cxd4", "cxd4", "Nge7", "O-O", "Nf5", "Nc3", "Nfxd4", "Nxd4", "Nxd4", "Be3", "Nxe2+", "Qxe2", "Qc7", "a3", "Qxe5", "f4", "Qc7", "Rac1", "Qd8", "Nb5", "Bd6", "Nxd6+", "Qxd6", "Bc5", "Qd8", "Qg4"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Pirc Defense: Austrian Attack (Main Line)",
        "description": "An aggressive setup against the Pirc Defense.",
        "category": "Pirc Defense",
        "moves": ["e4", "d6", "d4", "Nf6", "Nc3", "g6", "Be3", "Bg7", "Qd2", "O-O", "f3", "Nbd7", "Nge2", "c6", "Bh6", "b5", "h4", "b4", "Nd1", "Ba6", "Bxg7", "Kxg7", "h5"],
        "comments": ["","","","Technically speaking, this move followed by g6 introduces the Pirc...","","Note that 3...e5 transposes back to the Philidor Defense...","","","","This move is really asking for trouble...","Taking the g4-square away from Black's knight...","","","","We want to trade the strong defender on g7.","","We start our kingside attack!","","Although this move looks like we are undeveloping our knight...","","","","And White's attack punches through."]
      },
      {
        "name": "Pirc Defense: Transposing to Philidor",
        "description": "Side variation showing the transposition to the Philidor Defense.",
        "category": "Pirc Defense",
        "moves": ["e4", "d6", "d4", "Nf6", "Nc3", "e5", "dxe5", "dxe5", "Qxd8+", "Kxd8", "Bg5", "Be6"],
        "comments": ["","","","","","","","","","","",""]
      },
      {
        "name": "Pirc Defense: Philidor, Lion Variation",
        "description": "Side variation showing the Lion Variation of the Philidor.",
        "category": "Pirc Defense",
        "moves": ["e4", "d6", "d4", "Nf6", "Nc3", "e5", "Nf3", "Nbd7", "Bc4", "Be7", "O-O", "O-O", "Re1", "exd4", "Nxd4"],
        "comments": ["","","","","","","C41 Philidor Defense: Lion Variation","","","","","","","",""]
      },
      {
        "name": "Modern Defense: Gurgenidze System (Main Line)",
        "description": "Tackling the hypermodern Modern Defense.",
        "category": "Modern Defense",
        "moves": ["e4", "g6", "d4", "Bg7", "Nc3", "c6", "f4", "d5", "e5", "h5", "Nf3", "Nh6", "Be3", "Bg4", "h3", "Bxf3", "Qxf3", "Nf5", "Bf2", "h4", "Bd3", "e6", "O-O", "Nd7", "Ne2", "Bf8", "b3", "Be7", "c4"],
        "comments": ["","The Modern or Robatsch Defense...","","","","","","The Gurgenidze system...","The most principled choice...","This strange-looking pawn move is designed to secure the f5-square...","White continues their development in the most standard fashion...","","In the spirit of quick development...","Since Black is building a pawn chain on the white squares...","Forcing Black to clarify their intentions on the kingside.","","","","White secures the bishop...","Black has to deny White the g2-g4 break...","Developing the last piece.","","White's goal now is to blow up the center...","","","","The last preparatory measure...","","And White is clearly better..."]
      },
      {
        "name": "Modern Defense: Gurgenidze (Side: vs 14.c4)",
        "description": "Side variation from the Modern Defense chapter.",
        "category": "Modern Defense",
        "moves": ["e4", "g6", "d4", "Bg7", "Nc3", "c6", "f4", "d5", "e5", "h5", "Nf3", "Nh6", "Be3", "Bg4", "h3", "Bxf3", "Qxf3", "Nf5", "Bf2", "h4", "Bd3", "e6", "O-O", "Nd7", "Ne2", "Bf8", "c4", "dxc4", "Bxc4", "Nb6"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","BLACK CANT COMPLAIN HERE","",""]
      },
      {
        "name": "Alekhine's Defense: Exchange, Voronezh (Main Line)",
        "description": "Fighting the Alekhine's Defense with the Voronezh Variation.",
        "category": "Alekhine's Defense",
        "moves": ["e4", "Nf6", "e5", "Nd5", "d4", "d6", "c4", "Nb6", "exd6", "cxd6", "Nc3", "g6", "Be3", "Bg7", "Rc1", "O-O", "b3", "e5", "dxe5", "dxe5", "Qxd8", "Rxd8", "c5", "N6d7", "Bc4", "Nc6", "Ne4"],
        "comments": ["","This slightly provocative knight jump introduces the Alekhine Defense...","The principled response.","","Centah! When space is offered, we should grab it.","","The other main theoretical line begins with 4.Nf3...","","The text aims to resolve the battle for the center immediately...","","","","White is following a unique method of development...","","White removes the rook from the scope of the g7-bishop...","","The final step of bolstering the center.","Interestingly, Black does not really have anything else available!","White is aiming to play an endgame...","","","","Forcing Black to move backward...","","This natural developing move helps us control the d5-square...","","The pending Ng5 and Nd6 threats make White's position easier to play..."]
      },
      {
        "name": "Alekhine's Defense: Four Pawns Attack (Side)",
        "description": "Side variation: The Four Pawns Attack.",
        "category": "Alekhine's Defense",
        "moves": ["e4", "Nf6", "e5", "Nd5", "d4", "d6", "c4", "Nb6", "f4", "dxe5", "fxe5", "Bf5", "Nf3", "Nc6", "Be2", "e6", "O-O", "Be7", "Nc3", "O-O"],
        "comments": ["","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Alekhine's Defense: Four Pawns (Side: vs 6...Nc6)",
        "description": "Side variation within the Four Pawns Attack.",
        "category": "Alekhine's Defense",
        "moves": ["e4", "Nf6", "e5", "Nd5", "d4", "d6", "c4", "Nb6", "f4", "dxe5", "fxe5", "Nc6", "Be3", "Bf5", "Nc3", "e6", "Nf3", "Bb4", "Be2", "Na5"],
        "comments": ["","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Alapin Sicilian: vs 2...e5 (Main Line)",
        "description": "Handling the 2...e5 response in the Alapin.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "d5", "exd5", "Nxd5", "d4", "cxd4", "O-O", "Be7", "Nxf7", "Kxf7", "Qf3+", "Ke6", "a4"],
        "comments": ["","","This move introduces the Alapin Sicilian...","","","","","","","","","","","","","","","","","","This absolutely shocking move is the key to retaining our attack..."]
      },
      {
        "name": "Alapin Sicilian: vs 2...e5 (Side: 6...Na5)",
        "description": "Side variation within the 2...e5 Alapin.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "d5", "exd5", "Na5", "Bb5+", "Bd7", "Qa4", "Be7", "Bxd7+", "Nxd7", "Ne6", "fxe6", "dxe6"],
        "comments": ["","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Alapin Sicilian: Barmen Defense (Main Line)",
        "description": "A sharp, tactical line against the Barmen Defense.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "d5", "exd5", "Qxd5", "d4", "Nf6", "Nf3", "Bg4", "dxc5", "Qxc5", "Na3", "Nc6", "Nb5", "Qb6", "Be3", "Qa5", "b4", "Qd8", "Qxd8+", "Kxd8", "Ng5", "Bh5", "Be2", "Bg6", "O-O-O+", "Kc8", "Bd3", "Bh5", "Bf5+", "e6", "Nxe6", "Bxd1", "Nc5+"],
        "comments": ["","","","","","B22 Sicilian Defense: Alapin Variation, Barmen Defense...","","","This is the major junction here...","Barmen Defense : Modern line","Although the most popular move here is 6.Be2...","The endgame variation with6...Qxd1+ in analysed in the main course.","This knight move introduces various attacking schemes...","Blunder .. played 20% of the time","that knight gonna be annoying for sure :D","","","","","","","","Going for the unprotected f7-pawn.","","Yet another tempo move...","","White's initiative is overpowering...","","","","","","","","game is over"]
      },
      {
        "name": "Alapin Sicilian: Smith-Morra Declined (Main Line)",
        "description": "Against the 2...Nf6 line in the Alapin.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "Nf6", "e5", "Nd5", "d4", "cxd4", "Nf3", "e6", "cxd4", "d6", "Bc4", "Be7", "O-O", "O-O", "Qe2", "b6", "Rd1", "Bb7", "Bxd5", "Bxd5", "Nc3", "Bb7", "d5"],
        "comments": ["","","","This move challenges the e4-pawn...","","","","transposition : Smith-Morra Declined","White is no hurry to recapture on d4...","","","","","","","","Beginning a common maneuver: Qe2-e4-g4.","The e6-pawn blocks the development of the c8-bishop...","This move introduces a very unique plan:","","This is most surprising...","","","","This reveals the point of both Rd1 and the unusual trade on d5..."]
      },
      {
        "name": "Alapin Sicilian: Smith-Morra Declined (Side: 6.Bc4)",
        "description": "Side variation within the Smith-Morra Declined.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "Nf6", "e5", "Nd5", "d4", "cxd4", "Nf3", "Nc6", "Bc4", "Nb6", "Bb3", "dxc3", "Nxc3", "g6", "Ng5", "Nxe5", "f4", "h6", "fxe5", "hxg5", "O-O", "e6", "Ne4"],
        "comments": ["","","","","","","","","","","Once again, we prefer development over recovering material.","","","This is just a touch too greedy.","","","","very bad move","","","","","Black's position looks awful...","","white is unstopable"]
      },
      {
        "name": "Alapin Sicilian: Smith-Morra Declined (Side: 9...Nxe5)",
        "description": "Side variation within the Smith-Morra Declined.",
        "category": "Alapin Sicilian",
        "moves": ["e4", "c5", "c3", "Nf6", "e5", "Nd5", "d4", "cxd4", "Nf3", "Nc6", "Bc4", "Nb6", "Bb3", "dxc3", "Nxc3", "g6", "Ng5", "e6", "Nge4", "Nxe5", "Bg5", "Be7", "Bxe7", "Qxe7", "Qd4", "f6", "f4", "Nc6", "Nd6+"],
        "comments": ["","","","","","","","","","","","","","","","","","even if this is 2x better it is not enough to stop White Tactics!","","","","","","","","","","",""]
      }
    ]
  }
}

--- data/italian-toth.json ---
{
  "name": "Italian Game: Giuoco Piano & Tricky Gambits",
  "author": "IM Andras Toth",
  "description": "An aggressive introduction to the Italian Game, focusing on the Giuoco Piano, Scotch Gambit, and Evans Gambit.",
  "playerColor": "white",
  "orientation": "white",
  "theory": {
    "startingFen": null,
    "lines": [
      {
        "name": "Italian: Giuoco Pianissimo (5.c3)",
        "description": "The main line of the 'Quiet Game'.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "d3", "Bc5", "c3", "d6", "Nbd2", "a5", "Nf1", "Be6", "Bb5", "O-O"],
        "comments": ["","","","","Time to move on to the Italian...", "The first decision...","The main line. White defends their pawn...","I've played quite a few Italians...","Both sides have thousands of possible move orders...","I believe this is the simplest...","A move order tried a few times by Magnus Carlsen...","Taking control of the b4-square.","White continues the knight's journey.","Let's challenge White's bishop immediately...","White's only challenging continuation.","Magnus Carlsen had this position twice against Aryan Tari."]
      },
      {
        "name": "Italian: Giuoco Pianissimo (Side: 9.Bg5 Trap)",
        "description": "A side variation from the Giuoco Pianissimo line featuring a checkmate trap.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "d3", "Bc5", "c3", "d6", "Nbd2", "a5", "Nf1", "Be6", "Bb5", "O-O", "Bg5", "h6", "Bh4", "g5", "Nxg5", "hxg5", "Bxg5", "Nxe4", "Bxd8", "Bxf2+", "Ke2", "Bg4#"],
        "comments": ["","","","","","","","","","","","","","","","","Carlsen's first try...", "","","","We don't need to fear the piece sacrifice.","","","These positions can be scary, but here we have a knockout blow.","It turns out it's White's king that is in trouble.","","","A picturesque mate."]
      },
      {
        "name": "Italian: Two Knights, Scotch Gambit (Main Line)",
        "description": "An aggressive line beginning with 4.d4.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "d4", "exd4", "e5", "d5", "Bb5", "Ne4", "Nxd4", "Bd7", "Bxc6", "bxc6", "O-O", "Bc5", "f3", "Ng5", "f4", "Ne4", "Be3", "Bb6", "Nd2", "c5", "N4f3", "Nxd2", "Qxd2", "d4", "Bf2", "O-O", "a4", "a5", "Qd3"],
        "comments": ["","","","","The Italian is a trendy opening...","","Two Knights Defense, Open Variation...","C44 Scotch Game: Scotch Gambit...","Scotch Gambit, Advance Variation...","This counterthrust is always Black's best way to respond...","Both pawn captures are bad here...","","","","In return for the bishop pair we hope to exploit two positional factors...","","","","","White executes the f2-f4 idea...","","","The knight is now on an outpost...","Our best case scenario is to trade the b6-bishop...","This is an ambitious plan...","","","","","And suddenly our dark-squared strategy has completely shifted..."]
      },
      {
        "name": "Italian: Scotch Gambit (Side: 6.exd6?? Trap)",
        "description": "A side variation showing an opening trap for White.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "d4", "exd4", "e5", "d5", "exd6", "Bxd6", "Qe2+", "Be7", "O-O", "O-O", "Bg5", "Bf5"],
        "comments": ["","","","","","","","","","","just develops Black's pieces after","","","","","","",""]
      },
      {
        "name": "Italian: Scotch Gambit (Side: vs 13...Nxd2)",
        "description": "A side variation within the Scotch Gambit line.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "d4", "exd4", "e5", "d5", "Bb5", "Ne4", "Nxd4", "Bd7", "Bxc6", "bxc6", "O-O", "Bc5", "f3", "Ng5", "f4", "Ne4", "Be3", "Bb6", "Nd2", "Nxd2", "Qxd2", "c5", "Nf3", "Bf5", "Bf2", "O-O", "a4", "a5", "Rad1", "Rb8", "c4", "dxc4", "Qc3", "Qc8", "Nd2", "Bd7", "Nxc4", "Bxa4", "Rd3", "Bb5", "b3", "Qe6", "Bh4", "Qf5", "Rg3", "g6", "Kh1", "Bxc4", "bxc4", "c6", "Be7", "Rfc8", "Rg5", "Qe4", "f5", "Bd8", "e6", "Rb1", "exf7+", "Kxf7", "fxg6+", "Ke8", "Rc1", "Bxe7", "gxh7", "Qxh7", "Re5", "Rcb8", "Ree1", "Rxc1", "Qxc1", "Kd7", "Rd1+", "Ke8", "Qa1", "Rd8", "Re1", "Qh4", "Qxa5", "Qxc4", "Qc7", "Rd7", "Qc8+", "Rd8", "Qxc6+", "Kf7", "Qh6", "Bf6", "Qh7+", "Kf8", "Qh6+", "Bg7", "Qg6", "Qe2", "Qb1", "Qd3", "Qb6", "c4", "Qe6", "Bc3", "Qe7+", "Kg8", "Qe6+", "Kh8", "Rg1", "Bg7", "h3", "c3", "Qe7", "c2", "Rc1", "Qd1+", "Kh2", "Rc8", "Qh4+", "Kg8", "Qf4", "Qd4", "Qf3", "Bh6", "Qb3+", "Qc4", "Qg3+", "Kh7", "Re1", "Rc7"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","WE P","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Italian: Evans Gambit, Compromised Defense (Main)",
        "description": "The main line of the Evans Gambit, accepting the pawn.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "b4", "Bxb4", "c3", "Ba5", "d4", "exd4", "O-O", "dxc3", "Qb3", "Qf6", "Bg5", "Qg6", "Nxc3", "Bxc3", "Qxc3"],
        "comments": ["","","","","The Italian is a trendy opening...","","This move introduces the C51 Italian Game: Evans Gambit...","Black has accepted the gambit...","This is the move that earns the extra tempo for us...","This is Black's best response...","White goes for it anyway!","White happily gambits the second pawn...","","","This queen move is a common idea...","","White's development unfolds fluidly...","","","","White has everything one could ask for..."]
      },
      {
        "name": "Italian: Evans Gambit, Anderssen Defense",
        "description": "A second line in the Evans Gambit.",
        "category": "Italian Game",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "b4", "Bxb4", "c3", "Ba5", "d4", "exd4", "O-O", "Nf6", "Ba3", "d6", "e5", "dxe5", "Qb3"],
        "comments": ["","","","","","","","","","","","","","","This is another very important measure...","","Utilising the evergreen theme of the Evans...","","With a huge attack against the uncastled black king."]
      },
      {
        "name": "Deutz Gambit: Main Line (5...Bxd4)",
        "description": "The main line of the Deutz Gambit after Black recaptures on d4.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "Bxd4", "Nxd4", "Nxd4", "Bg5", "O-O", "f4", "d6", "Nc3", "h6", "fxe5", "dxe5", "Bxf6", "gxf6", "Qh5", "Kh7", "Bxf7", "Qe7", "Qg6+", "Kh8", "Qxh6#"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: Queen Trap Variation (5...exd4)",
        "description": "A devastating line where Black's queen gets trapped after a series of precise moves.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "exd4", "e5", "d5", "exf6", "dxc4", "fxg7", "Rg8", "Re1+", "Be6", "Bg5", "Qd5", "Nc3", "Qf5", "Ne4", "Rxg7", "Nh4", "Qd5", "Nf6+"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: vs 6...Ng4 (Bxf7+ Sacrifice)",
        "description": "A sharp variation involving a bishop sacrifice on f7.",
        "category": "Deutz Gambit",
        "moves": [
          "e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "exd4", 
          "e5", "Ng4", "Bxf7+", "Kxf7", "Ng5+", "Kg8", "Qxg4", "Nxe5", "Qe4", 
          "d6", "Qd5+", "Kf8", "f4", "c6", "fxe5+", "Ke8", "Qf7#"
        ],
        "comments": [
          "The King's Pawn Opening, aiming for central control.",
          "Black mirrors White's move, contesting the center.",
          "Develops a knight and attacks the e5 pawn.",
          "Develops and defends the e5 pawn.",
          "The Italian Game. The bishop puts pressure on Black's weak f7 square.",
          "The Giuoco Piano. Black develops their own bishop to a strong square.",
          "White castles, securing the king and preparing to bring the rook into the game.",
          "Black develops the kingside knight and puts pressure on White's e4 pawn.",
          "This is the Deutz Gambit! White challenges Black in the center at the cost of a pawn.",
          "Black accepts the gambit. The main alternative is 5...Bxd4.",
          "The key follow-up. White pushes the e-pawn to kick the f6 knight and open lines.",
          "A very aggressive response. Black avoids retreating and puts the knight on an active square, but it can also become a target.",
          "A brilliant sacrifice!! White gives up the bishop to completely expose the black king.",
          "Forced. Black must accept the sacrifice.",
          "The immediate follow-up. White uses the now-open diagonal to harass the king.",
          "Moving the king to the corner. 8...Ke8 is also possible but the king remains vulnerable.",
          "White recaptures the knight. The immediate threats are gone, but Black's king is still unsafe.",
          "Black wins back a pawn and challenges White's queen.",
          "A good centralizing move. The queen stays active and eyes Black's weak spots.",
          "Solidifies the center and gives the black queen an escape square.",
          "White continues to probe, not giving Black a moment to consolidate.",
          "Forced back. The king's position is becoming precarious.",
          "The critical attacking move! This threatens to take the e5 knight and opens the f-file for the rook.",
          "A resourceful try. Black counter-attacks the white queen, hoping to force it to a less active square.",
          "The decisive blow! It's a discovered check from the rook. White correctly determines that this attack is stronger than the threat to their own queen.",
          "Black is forced to move the king. The alternative, 13...cxd5, also loses quickly to 14. exd6+, a discovered check from the rook on f1.",
          "Checkmate. A beautiful and logical conclusion to the attack."
        ]
      },
      {
        "name": "Deutz Gambit: vs 6...Ng8 Retreat",
        "description": "Punishing the passive knight retreat to g8 with a queen sacrifice.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "exd4", "e5", "Ng8", "Ng5", "Nh6", "Re1", "O-O", "Qd3", "g6", "Qh3", "Kg7", "Qxh6+", "Kxh6", "Nxf7+", "Kg7", "Bh6+", "Kg8", "Nxd8+", "Kh8", "Bxf8", "Bxf8", "Nxc6", "dxc6"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: Queen Fianchetto Attack (5...Bxd4)",
        "description": "An aggressive continuation involving f4!! and a mating attack.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "Bxd4", "Nxd4", "Nxd4", "Bg5", "h6", "Bh4", "g5", "f4", "gxf4", "Rxf4", "exf4", "Qxd4", "O-O", "Bxf6", "Qe8", "Bh8", "d6", "Qg7#"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: vs 5...Nxd4 Trap",
        "description": "A line punishing the immediate knight capture on d4.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Bc5", "O-O", "Nf6", "d4", "Nxd4", "Nxe5", "O-O", "Be3", "Ne6", "Bxe6", "Bxe3", "Bxf7+", "Rxf7", "Nxf7", "Kxf7", "fxe3", "d6", "e5"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: via Two Knights (4...Bc5)",
        "description": "How the Deutz Gambit can arise from the Two Knights Defense move order.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "O-O", "Bc5", "d4"],
        "comments": ["","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: Two Knights Main (6...Be7!)",
        "description": "The correct and solid way for Black to respond in the Two Knights move order.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "O-O", "Nxe4", "Nc3", "Nxc3", "dxc3", "Be7", "Qd5", "O-O", "Nxe5"],
        "comments": ["","","","","","","","","","","","","","",""]
      },
      {
        "name": "Deutz Gambit: Two Knights Trap (6...Bc5??)",
        "description": "A classic trap Black can fall into after 4...Nxe4.",
        "category": "Deutz Gambit",
        "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "O-O", "Nxe4", "Nc3", "Nxc3", "dxc3", "Bc5", "Ng5", "O-O", "Qh5", "h6", "Nxf7", "Qf6", "Nxh6+", "Kh8", "Nf7+", "Kg8", "Qh8#"],
        "comments": ["","","","","","","","","","","","","","","","","","","","","","",""]
      }
    ]
  }
}
--- data/scotch.json ---
{
  "name": "Short & Sweet: The Scotch Game",
  "source": "Chessable.com",
  "description": "A detailed analysis of the Scotch Game, including early deviations and main lines, sourced from Chessable.",
  "lines": [
    {
      "headers": {
        "Event": "Short & Sweet: The Scotch Game",
        "Site": "Main Level",
        "Date": "????.??.??",
        "Round": "?",
        "White": "1. Early Scotch",
        "Black": "Deviations: 4...Nxd4?!",
        "Result": "*",
        "SourceTitle": "Main Level",
        "Source": "Chessable.com",
        "Comment": "short-sweet-the-scotch-game/course/5479, variation/223016"
      },
      "line_name": "1. Early Scotch: Deviations: 4...Nxd4?!",
      "movetree": [
        {
          "move_number": "1.",
          "move": "e4",
          "comment": "White's most popular first move attracts World champions and novices alike. Chess newcomers naturally gravitate towards it while many World Championships were decided by it. Fischer's move, together with 1. d4, has the simple plan of taking over the whole centre by playing d4 on the next move. In addition, it opens lines for his bishop and queen, while preparing rapid development and kingside castling."
        },
        {
          "move_number": "1...",
          "move": "e5",
          "comment": "Black avoids the wild, unbalanced Sicilian or the exotic French and Caro-Kann and instead heads for the solid Open Games."
        },
        {
          "move_number": "2.",
          "move": "Nf3",
          "comment": "[%csl Re5] A natural move - White attacks e5 and develops. By developing his kingside knight, White is one move closer to short castling."
        },
        {
          "move_number": "2...",
          "move": "Nc6",
          "comment": "Black replies similarly - he covers the pawn and develops. However, Black has other options at his disposal - most notably",
          "variations": [
            [
              {
                "move_number": "2...",
                "move": "Nf6",
                "comment": ", the Petroff Defence"
              }
            ],
            [
              {
                "move_number": "2...",
                "move": "d6",
                "comment": ", the Philidor Defence. Both of these openings will be covered in the final lines of this course."
              }
            ]
          ]
        },
        {
          "move_number": "3.",
          "move": "d4",
          "comment": "[%csl Re5,Ge4,Gd4] White's third most popular move is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly, some people might wonder why one would want to play the Scotch Game. I see a handful of benefits to playing the Scotch over the alternatives: 1. It's less common than both the Ruy Lopez and Italian game. This means that your opponents are less likely to be thoroughly-prepared for it and they should of course have less experience in it as well. 2. Unlike the Ruy Lopez (and the Italian to a lesser extent), Black's options are very limited. While black in the Ruy Lopez can choose from almost a dozen different defences, the Scotch boils down to two main lines. This makes the Scotch a bit easier to learn since there are fewer sidelines. 3. The Scotch can lead to a variety of different, interesting positions and structures which are hard to come by in different openings. This means that the Scotch should certainly appeal to creative and experimental chess players. So what is the idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez or Italian, White's plan is often to play d4 after lengthy preparation with c3 and so on. This means that White can recapture on d4 with the pawn (which is superior to capturing with the knight) but the downside is that Black is often not forced to take on d4! He typically would guard the e5 strongpoint and would very rarely relinquish control of the e5 pawn since it is his only real central foothold. This does come at a cost however. White spends one tempo to carry out this d4 break. Instead of developing his bishop and quickly castling, white has opted for a central break which grants him a larger centre. In the mainlines, Black tries to exploit this loss of time by quickly generating threats against both the undefended e4-pawn and the unstable knight on d4. Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6. These will be covered in the following two chapters while this chapter will examine what White should do when Black deviates earlier.",
          "variations": [
            [
              {
                "move_number": "3.",
                "move": "d4",
                "comment": "on the other hand takes a very different approach. White makes his central break early which forces Black to play"
              },
              {
                "move_number": "3...",
                "move": "exd4",
                "comment": "is not good, which will be demonstrated later.",
                "variations": [
                  [
                    {
                      "move_number": "3...",
                      "move": "d6"
                    }
                  ]
                ]
              },
              {
                "move_number": "4.",
                "move": "Nxd4",
                "comment": "White will have an extra pawn in the centre - e4 - while Black was forced to exchange his e5 pawn. As a result of this e4 pawn, White has better control over the centre."
              }
            ]
          ]
        },
        {
          "move_number": "3...",
          "move": "exd4",
          "comment": "The obvious and best move. Black is forced to cede the centre since",
          "variations": [
            [
              {
                "move_number": "3...",
                "move": "d6",
                "comment": "isn't good, as will be demonstrated."
              }
            ]
          ]
        },
        {
          "move_number": "4.",
          "move": "Nxd4",
          "comment": "[%csl Gd4,Ge4] To be totally honest, the Scotch Game only technically starts after this move, not 3. d4. White had a couple of options to deviate here, such as the Scotch gambit -",
          "variations": [
            [
              {
                "move_number": "4.",
                "move": "Bc4",
                "comment": ","
              }
            ],
            [
              {
                "move_number": "4.",
                "move": "c3",
                "comment": ". Neither of those will be covered here, as this is a course dedicated to the Scotch game."
              }
            ]
          ]
        },
        {
          "move_number": "4...",
          "move": "Nxd4",
          "nags": ["$6"],
          "comment": "While making this course, I was weighing up whether or not to show this move, since it is without any doubt a mistake. However, it is an unbelievably common mistake - it is Black's third most popular move!"
        },
        {
          "move_number": "5.",
          "move": "Qxd4",
          "comment": "[%csl Gd4,Rc6] The reason Nxd4 is a mistake is because it 'lures' White's queen to a great square. Usually, a queen in the centre is vulnerable because the opponent can gain tempi on it for free. This is not the case here. With Black's b8-knight already exchanged, there is no irritating ...Nc6 to chase our queen away."
        },
        {
          "move_number": "5...",
          "move": "d6",
          "comment": "Black's most common move."
        },
        {
          "move_number": "6.",
          "move": "Nc3"
        },
        {
          "move_number": "6...",
          "move": "Nf6"
        },
        {
          "move_number": "7.",
          "move": "f3",
          "comment": "[%cal Gf3g4,Bc1e3,Be1c1][%csl Gg4] Our plan in this variation is to go for a Yugoslav attack setup with Be3, O-O-O etc.",
          "variations": [
            [
              {
                "move_number": "7.",
                "move": "Be3",
                "comment": "immediately allows the extra possibility of"
              },
              {
                "move_number": "7...",
                "move": "Ng4",
                "comment": ", so this prophylactic move first is preferable."
              }
            ]
          ]
        },
        {
          "move_number": "7...",
          "move": "Be7"
        },
        {
          "move_number": "8.",
          "move": "Be3",
          "comment": "[%cal Be1c1]"
        },
        {
          "move_number": "8...",
          "move": "O-O"
        },
        {
          "move_number": "9.",
          "move": "O-O-O",
          "nags": ["$16"],
          "comment": "[%cal Bg2g4,Bh2h4][%csl Rg8] White has a wonderful attacking position - next comes g4 and Black will have to be very careful not to get mated within a dozen moves. White's setup resembles the Dragon's Yugoslav attack, except Black is missing his usual Dragon counterplay."
        }
      ]
    },
    {
      "headers": {
        "Event": "Short & Sweet: The Scotch Game",
        "Site": "Main Level",
        "Date": "????.??.??",
        "Round": "?",
        "White": "2. Early Scotch",
        "Black": "Deviations: 3...d6?!",
        "Result": "*",
        "SourceTitle": "Main Level",
        "Source": "Chessable.com",
        "Comment": "short-sweet-the-scotch-game/course/5479, variation/223015"
      },
      "line_name": "2. Early Scotch: Deviations: 3...d6?!",
      "movetree": [
        {
          "move_number": "1.",
          "move": "e4"
        },
        {
          "move_number": "1...",
          "move": "e5"
        },
        {
          "move_number": "2.",
          "move": "Nf3"
        },
        {
          "move_number": "2...",
          "move": "Nc6"
        },
        {
          "move_number": "3.",
          "move": "d4"
        },
        {
          "move_number": "3...",
          "move": "d6",
          "nags": ["$6"],
          "comment": "[%cal Gd6e5] A surprisingly common error. Black wants to reinforce the e5-pawn, which makes sense, but White is simply given a free hand in the centre now:"
        },
        {
          "move_number": "4.",
          "move": "d5",
          "nags": ["$1"],
          "comment": "Going into the endgame by capturing",
          "variations": [
            [
              {
                "move_number": "4.",
                "move": "dxe5",
                "comment": "is also possible and good, but this is just as strong and keeps the queens on the board."
              }
            ]
          ]
        },
        {
          "move_number": "4...",
          "move": "Nce7",
          "comment": "Black's knight is heading to g6."
        },
        {
          "move_number": "5.",
          "move": "c4",
          "comment": "[%cal Bb1c3][%csl Gc4,Gd5,Ge4] Solidifying d5 and preparing to play Nc3."
        },
        {
          "move_number": "5...",
          "move": "Nf6",
          "comment": "[%csl Re4] Developing and attacking e4."
        },
        {
          "move_number": "6.",
          "move": "Nc3",
          "comment": "[%cal Gc3e4][%csl Ge4] Covering e4."
        },
        {
          "move_number": "6...",
          "move": "Ng6",
          "comment": "Black needs to move his knight again so that his dark-squared bishop can develop."
        },
        {
          "move_number": "7.",
          "move": "h4",
          "nags": ["$1"],
          "comment": "[%cal Bh4h5][%csl Rg6] This is a strong idea which I like very much. White exploits the awkardly placed knight on g6 and intends to kick it back again with h5."
        },
        {
          "move_number": "7...",
          "move": "Bg4",
          "comment": "[%cal Gg4h5,Gf6h5][%csl Gh5] Black is forced to prevent h5."
        },
        {
          "move_number": "8.",
          "move": "Be2"
        },
        {
          "move_number": "8...",
          "move": "c6",
          "comment": "...c6 is a standard idea to chip away at White's centre followed by queenside counterplay - with ... a6 and ...b5 - but this plan is really going nowhere in this position."
        },
        {
          "move_number": "9.",
          "move": "Be3"
        },
        {
          "move_number": "9...",
          "move": "Be7"
        },
        {
          "move_number": "10.",
          "move": "g3",
          "nags": ["$16"],
          "comment": "[%cal Gg3f4,Bf3d2,Be2g4][%csl Gf4] A very strong prophylactic move! White protects h4 again, but more importantly he covers the f4 square preventing any ...Nf4 intrusions. Next White intends Nd2 (trading off white's bad bishop for Black's good one) with a great position for white."
        }
      ]
    }
  ]
}
--- data/traxler.json ---
{
    "name": "Traxler Counter-Attack",
    "playerColor": "black",
    "orientation": "black",
    "theory": {
        "startingFen": null,
        "lines": [
            {
                "name": "Line 1: Kxf2 Main (Kf3)",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kxf2", "Nxe4+", "Kf3", "Qf6+", "Kxe4", "d5+", "Bxd5", "Qf4+", "Kd3", "Qd4+", "Ke2", "Qxd5", "Kf1", "Qxf7+"],
                "description": "The main line where White takes on f2 and walks into the king hunt. Critical line for both sides.",
                "hint": "After Ng5, Black sacrifices the bishop with Bc5-Bxf2+ to drag the white king forward!",
                "evaluation": "Black gets excellent compensation and attacking chances",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 1.1: Kxf2 then Ke1",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kxf2", "Nxe4+", "Ke1", "Qh4+", "g3", "Nxg3", "hxg3", "Qxh1+", "Bf1", "O-O"],
                "description": "White tries Ke1 to escape. Black gets excellent compensation with the rook on h1.",
                "hint": "After Ke1, Black brings the queen to h4+ and wins the exchange on h1",
                "evaluation": "Black has strong compensation for the piece",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 1.2: Kxf2 then Kf1",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kxf2", "Nxe4+", "Kf1", "Qh4", "Qf3", "Nd4", "g3", "Qh3+", "Qg2", "d5", "Bxd5", "Qf5+", "Ke1", "Nxc2+"],
                "description": "Kf1 leads to complex tactics. Black maintains strong pressure with tactical shots.",
                "hint": "Against Kf1, Black's queen goes to h4 and creates immediate threats",
                "evaluation": "Sharp tactical play favoring Black",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 1.3: King Hunt (Ke2) - The Famous Mate!",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kxf2", "Nxe4+", "Ke2", "Nd4+", "Ke3", "Qh4", "g3", "Nxg3", "hxg3", "Qxg3+", "Ke4", "d5+", "Kxd5", "c6+", "Kd6", "Nf5+", "Kc5", "b6+", "Kb4", "a5+", "Ka4", "b5+", "Bxb5", "cxb5+", "Kxb5", "Bd7+", "Kc5", "Rc8+", "Kb6", "Qg6+", "Nd6+", "Qxd6+", "Ka7", "Qc7+", "Ka6", "Ra8#"],
                "description": "The famous king hunt! White's king gets mated in the center of the board. A masterpiece of tactics.",
                "hint": "The white king takes a deadly walk across the board - one of the most beautiful tactical sequences in chess!",
                "evaluation": "Forced mate for Black - the crown jewel of the Traxler!",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 1.4: Kxf2 then Ke3",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kxf2", "Nxe4+", "Ke3", "Qh4", "g3", "Nxg3", "hxg3", "Qd4+", "Ke2", "Qxc4+"],
                "description": "Ke3 is another try but Black gets excellent play with the centralized queen.",
                "hint": "After Ke3, the black queen dominates the center and wins material",
                "evaluation": "Black has winning advantage",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 2: Kf1 Variation (Refusing the Bishop)",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nxf7", "Bxf2+", "Kf1", "Qe7", "Nxh8", "d5", "exd5", "Nd4", "c3", "Bg4", "Qa4+", "Nd7", "cxd4", "Qf6", "dxe5", "Qf4", "g3", "Bxg3+", "Kg2", "Qf2#"],
                "description": "If White refuses the bishop sacrifice with Kf1, Black gets a beautiful mating attack.",
                "hint": "If White doesn't take the bishop, Black develops with Qe7 and gets a crushing attack",
                "evaluation": "Forced mate for Black if White refuses the sacrifice",
                "category": "Nxf7 Sacrifice Lines"
            },
            {
                "name": "Line 3: Bxf7+ Bishop Sacrifice",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Bxf7+", "Ke7", "Bb3", "Rf8", "Nc3", "Qe8", "O-O", "d6", "d3", "Qg6", "Nf3", "Bg4", "Bd2", "Nd4"],
                "description": "White can try the bishop sacrifice instead. Black gets good compensation but it's more complex.",
                "hint": "Against the bishop sacrifice, Black accepts with Ke7 and develops actively",
                "evaluation": "Complex position with good compensation for Black",
                "category": "Bxf7+ Bishop Sacrifice"
            },
            {
                "name": "Line 4: Quiet Retreat (Nf3)",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nf3", "d5", "exd5", "Nxd5", "O-O", "O-O", "d3", "f5", "Ng5", "Qd6", "f4", "exf4", "Bxf4", "Nxf4", "Rxf4", "Bd6"],
                "description": "If White retreats quietly, Black gets excellent central control and attacking chances.",
                "hint": "Against the quiet retreat, Black strikes in the center with d5!",
                "evaluation": "Equal position with good play for Black",
                "category": "Quiet Development"
            },
            {
                "name": "Line 5: d4 Variation",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "d4", "exd4", "O-O", "dxc3", "bxc3", "d6", "Re1+", "Kf8", "Nh3", "h6", "Nf4", "g5", "Nd5", "Nxd5", "Bxd5", "c6"],
                "description": "White can try d4 to open the center, but Black gets good piece play.",
                "hint": "Against d4, Black takes and develops with good compensation",
                "evaluation": "Approximately equal with active piece play",
                "category": "d4 Variations"
            },
            {
                "name": "Line 6: Nxf7 Declined - Nh3",
                "moves": ["e4", "e5", "Nf3", "Nc6", "Bc4", "Nf6", "Ng5", "Bc5", "Nh3", "d5", "exd5", "Nxd5", "Bxd5", "Qxd5", "O-O", "O-O", "d3", "f5", "f4", "exf4", "Nxf4", "Qh5"],
                "description": "White can retreat to h3 to avoid complications. Black gets active piece play.",
                "hint": "Against Nh3, Black seizes the center with d5 and gets excellent development",
                "evaluation": "Good compensation for Black with active pieces",
                "category": "Quiet Development"
            }
        ]
    },
    "exercises": {
        "startingFen": "r1bqk2r/pppp1ppp/2n2n2/2b1p1N1/2B1P3/8/PPPP1PPP/RNBQK2R w KQkq - 4 5",
        "lines": [
            {
                "name": "Exercise 1: Basic Traxler Sacrifice",
                "description": "White just played Ng5, attacking f7. How should Black respond with the Traxler Counter-Attack?",
                "fen": "r1bqk2r/pppp1ppp/2n2n2/2b1p1N1/2B1P3/8/PPPP1PPP/RNBQK2R w KQkq - 4 5",
                "moves": ["Nxf7", "Bxf2+", "Kxf2", "Nxe4+"],
                "hint": "Sacrifice the bishop to deflect the king and attack e4! This is the signature Traxler sacrifice.",
                "instruction": "The Traxler begins with a shocking bishop sacrifice to drag the white king forward.",
                "category": "Basic Tactics"
            },
            {
                "name": "Exercise 2: Find the Correct King Move",
                "description": "After 1.Nxf7 Bxf2+ 2.Kxf2 Nxe4+, White tries 3.Kf3. How should Black continue the attack?",
                "fen": "r1bqk2r/pppp1ppp/2n5/4p3/2B1n3/5K2/PPPP2PP/RNBQ3R b kq - 1 6",
                "moves": ["Kf3", "Qf6+", "Kxe4", "d5+"],
                "hint": "Bring the queen into the attack with check! The white king is very exposed.",
                "instruction": "After Kf3, Black brings the queen into the attack to hunt the white king.",
                "category": "King Hunt"
            },
            {
                "name": "Exercise 3: King Hunt Continuation",
                "description": "White played 3.Ke2 instead. Find Black's powerful continuation to start the famous king hunt!",
                "fen": "r1bqk2r/pppp1ppp/2n5/4p3/2B1n3/8/PPPPK1PP/RNBQ3R b kq - 1 6",
                "moves": ["Ke2", "Nd4+", "Ke3", "Qh4"],
                "hint": "Force the king forward with checks, then bring the queen into the attack! This is the start of the famous king hunt.",
                "instruction": "Ke2 allows the most famous king hunt in chess history. Force the king into the center!",
                "category": "King Hunt"
            },
            {
                "name": "Exercise 4: Alternative Defense - Kf1",
                "description": "What if White doesn't take the bishop and plays 2.Kf1 instead of Kxf2?",
                "fen": "r1bqk2r/pppp1ppp/2n2n2/4p1N1/2B1P1b1/8/PPPP1KPP/RNBQ3R b kq - 0 6",
                "moves": ["Kf1", "Qe7", "Nxh8", "d5"],
                "hint": "If White refuses the bishop, develop the queen aggressively and attack the center!",
                "instruction": "Against Kf1, Black gets excellent compensation by developing actively and striking in the center.",
                "category": "Alternative Lines"
            },
            {
                "name": "Exercise 5: Quiet Defense Test",
                "description": "White retreats the knight quietly with 3.Nf3 instead of capturing. How should Black respond?",
                "fen": "r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R b KQkq - 5 5",
                "moves": ["Nf3", "d5", "exd5", "Nxd5"],
                "hint": "If White retreats quietly, strike in the center immediately with d5!",
                "instruction": "Against quiet moves, Black should seize the initiative with central action.",
                "category": "Alternative Lines"
            },
            {
                "name": "Exercise 6: Bishop Sacrifice Alternative",
                "description": "White tries the bishop sacrifice 3.Bxf7+ instead of Nxf7. How should Black respond?",
                "fen": "r1bqk2r/pppp1Bpp/2n2n2/2b1p1N1/4P3/8/PPPP1PPP/RNBQK2R b KQkq - 0 5",
                "moves": ["Bxf7+", "Ke7", "Bb3", "Rf8"],
                "hint": "Accept the sacrifice and develop actively! The bishop sacrifice is less dangerous than Nxf7.",
                "instruction": "The bishop sacrifice leads to complex play but Black gets reasonable compensation.",
                "category": "Alternative Lines"
            },
            {
                "name": "Exercise 7: Complete the King Hunt!",
                "description": "You're in the middle of the famous king hunt. White's king is on e4, and you just played d5+. Complete the mating sequence!",
                "fen": "r1bqk1nr/ppp3pp/2n5/3pK3/2B1p3/6q1/PPPP2PP/RNB2Q1R w kq d6 0 10",
                "moves": ["Kxd5", "c6+", "Kd6", "Nf5+", "Kc5", "b6+", "Kb4", "a5+", "Ka4", "b5+", "Bxb5", "cxb5+", "Kxb5", "Bd7+", "Kc5", "Rc8+", "Kb6", "Qg6+", "Nd6+", "Qxd6+", "Ka7", "Qc7+", "Ka6", "Ra8#"],
                "hint": "The white king must walk to its doom! Continue with forcing checks to drive the king to a6 where it gets mated!",
                "instruction": "This is the crown jewel of the Traxler - a forced mate with the king in the center of the board!",
                "category": "King Hunt"
            }
        ]
    },
    "spacedRepetition": {
        "cards": [
            {
                "question": "What is the key move that starts the Traxler Counter-Attack?",
                "answer": "Bxf2+! This bishop sacrifice deflects the white king and starts the attack.",
                "category": "Opening Theory"
            },
            {
                "question": "After 1.Nxf7 Bxf2+ 2.Kxf2 Nxe4+ 3.Ke2, what does Black play?",
                "answer": "Nd4+! This starts the famous king hunt by forcing the white king forward.",
                "category": "Tactical Sequences"
            },
            {
                "question": "What happens if White plays Kf1 instead of taking the bishop on f2?",
                "answer": "Black plays Qe7 and gets excellent compensation with a strong attack.",
                "category": "Alternative Lines"
            },
            {
                "question": "In the king hunt line, where does the white king ultimately get mated?",
                "answer": "On a6! The white king takes a famous walk across the board and gets mated in the corner.",
                "category": "Tactical Sequences"
            },
            {
                "question": "How should Black respond if White retreats quietly with Nf3?",
                "answer": "d5! Strike in the center immediately and seize the initiative.",
                "category": "Positional Understanding"
            }
        ]
    }
}
--- data/italian-variations-test.pgn ---
[Event "Italian Game: Variations Study"]
[Site "Training Course"]
[Date "2025.01.01"]
[Round "?"]
[White "Student"]
[Black "Computer"]
[Result "*"]
[ECO "C50"]
[Opening "Italian Game"]
[Annotator "Chess Trainer"]

{This study covers the Italian Game with key variations and tactical themes.}

1. e4 {The King's pawn opening. [%cal Ge2e4] Controls the center immediately.} 
e5 {Black mirrors White's central control.} 

2. Nf3 {Develops the knight and attacks the e5 pawn. [%cal Gg1f3,Rf3e5]} 
Nc6 {The natural defense of the e5 pawn.} 

3. Bc4 {The Italian Game! The bishop targets the weak f7 square. [%cal Gf1c4,Rc4f7]} 
Bc5 {The Giuoco Piano - Black develops symmetrically.} 

( 3... Be7 {The Hungarian Defense - a solid but passive setup.} 
4. d3 {White continues with a solid positional approach.} 
Nf6 5. Ng5 {The Rousseau Gambit! A tricky try.} 
O-O 6. f4 {White goes for a kingside attack.} 
exf4 7. Bxf4 {With good compensation for the pawn.} )

( 3... f5 {The Rousseau Gambit accepted! Very aggressive but risky.} 
4. d3 {The solid response.} 
fxe4 5. dxe4 Nf6 6. O-O {White has excellent development compensation.} )

( 3... Nf6 {The Two Knights Defense - Black avoids the pin.} 
4. Ng5 {The aggressive continuation. [%cal Rf3g5,Rg5f7]} 
d5 {The Polerio Defense!} 
5. exd5 Nxd5 
( 5... Na5 {The main line of the Two Knights.} 
6. Bb5+ c6 7. dxc6 bxc6 8. Be2 {With a complex position.} )
6. Nxf7 {The famous knight sacrifice! [%csl Rf7]} 
Kxf7 7. Qf3+ Ke6 {The king must advance - very dangerous!} )

4. c3 {The main line of the Giuoco Piano. [%cal Gc2c3]} 
Nf6 {Black develops the kingside knight.} 

5. d4 {The center strike! [%cal Gd2d4,Rd4e5,Rd4c5]} 
exd4 {Black accepts the challenge.} 

( 5... Bb6 {The Moller Defense - avoiding the central tension.} 
6. dxe5 Nxe4 7. Qd5 {White regains the piece with advantage.} )

( 5... Bd6 {A solid retreat keeping the center.} 
6. dxe5 Nxe5 7. Nxe5 Bxe5 8. f4 {White gets the bishop pair.} )

6. cxd4 {[%cal Gc3d4]} 
Bb4+ {The Greco Attack! Black gives check to disrupt White's development.} 

( 6... Nxe4 {The Blackburne Gambit - very sharp!} 
7. d5 {The best response.} 
Nf6 8. dxc6 Nxc4 9. cxb7 {Material mayhem!} )

7. Nc3 {[%cal Gb1c3]} 
Nxe4 {Black wins the e4 pawn temporarily.} 

8. O-O {[%cal Ge1g1] Castling with tempo due to the pin.} 
Bxc3 {Black breaks the pin.} 

( 8... Nxc3 {Alternative capture.} 
9. bxc3 Bxc3 10. Qb3 {White has compensation.} )

9. d5 {[%cal Gd4d5] The central advance!} 
Bf6 {Black's pieces become awkwardly placed.} 

10. Re1 {[%cal Gf1e1] Pinning the knight and increasing pressure.} 
Ne7 {Forced retreat.} 

11. Rxe4 {White regains the material with a great position.} 
d6 {Black tries to consolidate.} 

12. Bg5 {[%cal Gc1g5] Increasing the pressure on Black's position.} 
Bxg5 13. Nxg5 {With a winning attack for White.} *
--- data/london.pgn ---
[Event "London System Complete Repertoire"]
[Site "Chess Training Course"]
[Date "2025.01.01"] 
[Round "?"]
[White "Student"]
[Black "Computer"]
[Result "*"]
[Author "GM Simon Williams"]
[SourceTitle "London System vs King's Indian Setup"]

{Welcome to the London System! This solid opening gives White good chances for an advantage while avoiding massive theory. The key ideas are rapid development, central control, and kingside attack.}

1. d4 {The London System starts with this flexible move, controlling e5 and c5.} d5 {Black's most solid response, establishing central presence.} 

2. Nf3 {Develops the knight to its best square, preparing to support the e4 advance.} Nf6 {Black mirrors White's development.}

3. Bf4 {The signature London System move! This bishop is perfectly placed on f4, controlling e5 and the long diagonal.} 

( 3. Bg5 {This is the Trompowsky Attack, a related but different system.} h6 4. Bh4 c5 {Black gets good counterplay.} )

3... c5 {Black challenges the center immediately. This is one of the main defensive setups.}

( 3... e6 {The French Defense setup - very solid for Black.} 4. e3 Bd6 {Challenging our bishop.} 5. Bxd6 Qxd6 6. c4 {White gets a good position.} )

( 3... g6 {The King's Indian setup - Black fianchettoes the bishop.} 4. e3 Bg7 5. h4! {A key attacking idea in the London!} h6 6. Bd3 O-O 7. Nbd2 {White has excellent attacking prospects.} )

4. e3 {Solid and flexible, supporting the d4 pawn and preparing Bd3.} Nc6 {Natural development.}

5. c3 {Preparing b2-b4 to gain space on the queenside.} Qb6 {Black puts pressure on the b2 pawn.}

6. Qb3 {Trading queens simplifies the position in White's favor.} Qxb3 7. axb3 {White gets the better pawn structure and easier play.}

( 6. b3 {A solid alternative, maintaining the pawn structure.} cxd4 7. exd4 Bf5 8. Bd3 {White has a slight edge.} )

7... a6 {Preventing Nb5.} 8. Bd3 {The bishop finds its ideal square, eyeing the kingside.} e6 9. Nbd2 {Completing development.} Bd7 10. O-O {White has completed development with a solid, slightly better position.} *
--- data/scotch.pgn ---
[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "1. Early Scotch"]
[Black "Deviations: 4...Nxd4?!"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223016"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { [%csl Re5] A natural
move - White attacks e5 and develops. By developing his kingside knight,
White is one move closer to short castling. } 2... Nc6 ( { Black replies
similarly - he covers the pawn and develops. However, Black has other
options at his disposal - most notably } 2... Nf6 { , the Petroff Defence }
) ( { and } 2... d6 { , the Philidor Defence. Both of these openings will
be covered in the final lines of this course. }) 3. d4 { [%csl Re5,Ge4,Gd4]
White's third most popular move is 3. d4, after 3. Bb5 (the Ruy Lopez) and
3. Bc4 (the Italian). Firstly, some people might wonder why one would want
to play the Scotch Game. I see a handful of benefits to playing the Scotch
over the alternatives: 1. It's less common than both the Ruy Lopez and
Italian game. This means that your opponents are less likely to be
thoroughly-prepared for it and they should of course have less experience
in it as well. 2. Unlike the Ruy Lopez (and the Italian to a lesser
extent), Black's options are very limited. While black in the Ruy Lopez can
choose from almost a dozen different defences, the Scotch boils down to two
main lines. This makes the Scotch a bit easier to learn since there are
fewer sidelines. 3. The Scotch can lead to a variety of different,
interesting positions and structures which are hard to come by in different
openings. This means that the Scotch should certainly appeal to creative
and experimental chess players. So what is the idea behind 3. d4? Basically
it boils down to the centre. In the Ruy Lopez or Italian, White's plan is
often to play d4 after lengthy preparation with c3 and so on. This means
that White can recapture on d4 with the pawn (which is superior to
capturing with the knight) but the downside is that Black is often not
forced to take on d4! He typically would guard the e5 strongpoint and would
very rarely relinquish control of the e5 pawn since it is his only real
central foothold. } (3. d4 { on the other hand takes a very different
approach. White makes his central break early which forces Black to play }
3... exd4 (3... d6 { is not good, which will be demonstrated later. }) {
After } 4. Nxd4 { White will have an extra pawn in the centre - e4 - while
Black was forced to exchange his e5 pawn. As a result of this e4 pawn,
White has better control over the centre. }) { This does come at a cost
however. White spends one tempo to carry out this d4 break. Instead of
developing his bishop and quickly castling, white has opted for a central
break which grants him a larger centre. In the mainlines, Black tries to
exploit this loss of time by quickly generating threats against both the
undefended e4-pawn and the unstable knight on d4. Therefore, after 4. Nxd4
Black's two main choices are ...Bc5 and ...Nf6. These will be covered in
the following two chapters while this chapter will examine what White
should do when Black deviates earlier. } 3... exd4 ( { The obvious and best
move. Black is forced to cede the centre since } 3... d6 { isn't good, as
will be demonstrated. }) 4. Nxd4 { [%csl Gd4,Ge4] } ( { To be totally
honest, the Scotch Game only technically starts after this move, not 3. d4.
White had a couple of options to deviate here, such as the Scotch gambit -
} 4. Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those
will be covered here, as this is a course dedicated to the Scotch game. })
4... Nxd4 $6 { While making this course, I was weighing up whether or not
to show this move, since it is without any doubt a mistake. However, it is
an unbelievably common mistake - it is Black's third most popular move! }
5. Qxd4 { [%csl Gd4,Rc6] The reason Nxd4 is a mistake is because it 'lures'
White's queen to a great square. Usually, a queen in the centre is
vulnerable because the opponent can gain tempi on it for free. This is not
the case here. With Black's b8-knight already exchanged, there is no
irritating ...Nc6 to chase our queen away. } 5... d6 { Black's most common
move. } 6. Nc3 Nf6 7. f3 { [%cal Gf3g4,Bc1e3,Be1c1][%csl Gg4] } ( { Our
plan in this variation is to go for a Yugoslav attack setup with Be3, O-O-O
etc. } 7. Be3 { immediately allows the extra possibility of } 7... Ng4 { ,
so this prophylactic move first is preferable. }) 7... Be7 8. Be3 { [%cal
Be1c1] } 8... O-O 9. O-O-O $16 { [%cal Bg2g4,Bh2h4][%csl Rg8] White has a
wonderful attacking position - next comes g4 and Black will have to be very
careful not to get mated within a dozen moves. White's setup resembles the
Dragon's Yugoslav attack, except Black is missing his usual Dragon
counterplay. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "2. Early Scotch"]
[Black "Deviations: 3...d6?!"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223015"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... d6 $6 {
[%cal Gd6e5] A surprisingly common error. Black wants to reinforce the
e5-pawn, which makes sense, but White is simply given a free hand in the
centre now: } 4. d5 $1 ( { Going into the endgame by capturing } 4. dxe5 {
is also possible and good, but this is just as strong and keeps the queens
on the board. }) 4... Nce7 { Black's knight is heading to g6. } 5. c4 {
[%cal Bb1c3][%csl Gc4,Gd5,Ge4] Solidifying d5 and preparing to play Nc3. }
5... Nf6 { [%csl Re4] Developing and attacking e4. } 6. Nc3 { [%cal
Gc3e4][%csl Ge4] Covering e4. } 6... Ng6 { Black needs to move his knight
again so that his dark-squared bishop can develop. } 7. h4 $1 { [%cal
Bh4h5][%csl Rg6] This is a strong idea which I like very much. White
exploits the awkardly placed knight on g6 and intends to kick it back again
with h5. } 7... Bg4 { [%cal Gg4h5,Gf6h5][%csl Gh5] Black is forced to
prevent h5. } 8. Be2 c6 { ...c6 is a standard idea to chip away at White's
centre followed by queenside counterplay - with ... a6 and ...b5 - but this
plan is really going nowhere in this position. } 9. Be3 Be7 10. g3 $16 {
[%cal Gg3f4,Bf3d2,Be2g4][%csl Gf4] A very strong prophylactic move! White
protects h4 again, but more importantly he covers the f4 square preventing
any ...Nf4 intrusions. Next White intends Nd2 (trading off white's bad
bishop for Black's good one) with a great position for white. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "3. Early Scotch"]
[Black "Deviations: 4...Bb4"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223017"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated in the previous line. } 4. Nxd4 ( { To be totally
honest, the Scotch Game only technically starts after this move, not 3. d4.
White had a couple of options to deviate here, such as the Scotch gambit -
} 4. Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those
will be covered here, as this is a course dedicated to the Scotch game. })
4... Bb4+ { [%cal Gb4e1,Bc2c3][%csl Re1,Gc3] A funny idea of Black's -
Black checks, hoping to lure white's pawn to c3. He reasons that this
benefits Black, since the knight would prefer to use the c3 square. } 5. c3
{ [%csl Gc3] White gains a tempo on the bishop. The pawn is quite useful on
c3, but Black reasons that it is more of a liability since it deprives
White's knight of that square. } 5... Bc5 { With the pawn on c3, White
potentially could have difficulties defending e4 if he doesn't take
precautions. } 6. Be3 { [%cal Bd4c6,Ge3c5][%csl Rc5] Natural development,
supporting the knight on d4. This move also carries the threat of winning a
piece - Nxc6 followed by Bxc5. } 6... Bb6 { [%csl Gb6] Black retreats the
bishop to a protected square so that White's threat is dealt with. } 7. Nf5
$1 { [%csl Rg7] A strong move. White exploits the absence of Black's
dark-squared bishop on f8 and attacks g7. } 7... g6 8. Bxb6 { We take on b6
to vacate the e3 square for White's knight. } 8... axb6 ( { Note that
taking the knight on f5 would be a mistake } 8... gxf5 $2 9. Bd4 { is
strong. }) 9. Ne3 { [%cal Ge3f5,Ge3d5,Bd7d5,Bf7f5][%csl Ge3,Gf5,Gd5] The
knight has been rerouted from d4 to the fantastic e3-square. From here it
performs the important function of preventing Black's central breaks -
...d5 and to a lesser extent also ...f5. } 9... Nf6 { Natural development -
Black wants to castle. } 10. f3 { [%cal Gf3e4][%csl Ge4] } ( { Note that
defending the pawn like this instead of } 10. Nd2 { is better. We want our
knight to head to c3 after playing the pawn to c4. }) 10... O-O 11. c4 $14
{ [%cal Gc4d5,Ge4d5,Bb1c3,Bf1e2,Be1g1][%csl Gc3,Ge3] The pawn on c4
performs a great role of crushing Black's ...d5 dreams and securing that
square for White's knights in the future. Moreover c4 also frees up the c3
square so our b1-knight can develop there. Over the next few moves White
will develop and castle with a great position. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "4. Early Scotch"]
[Black "Deviations: 4...Qh4"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223018"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Qh4
{ [%cal Gh4e4][%csl Re4] } ( { Of the alternatives to main moves - } 4...
Bc5) ( { and } 4... Nf6 { , this is probably the most ambitious. White
should definitely know some theory here to ensure he gets an advantageous
position - the good news is that if White knows a bit of theory here, he
will come out of the opening better. Black attacks the e4 pawn and intends
to apply rapid pressure on it, hoping to win it. }) 5. Nc3 { [%cal Gc3e4]
Defending e4. } 5... Bb4 { [%cal Gh4e4,Gb4e1][%csl Re4,Rc3] Once again,
Black threatens e4 by pinning the knight which defends it. } 6. Be2 $1 {
[%cal Be1g1,Bd4b5][%csl Rc7] A very strong move to remember! White simply
ignores the threat to the e4-pawn and develops. The problem for Black is
that he has wasted a lot of time to attack e4 and additionally his queen is
now exposed. White can gladly sacrifice the pawn and end up with a great
position. } 6... Qxe4 { [%csl Rd4,Rg2] Black has gained the pawn he was
looking for and additionally attacks the knight on d4 and pawn on g2. } 7.
Nb5 $1 { [%cal Gb5c7][%csl Rc7] } ( { White makes a counter threat of his
own - Nxc7+. Black doesn't have time for } 7. Nb5 Qxg2 $2 { because of } 8.
Bf3 { . }) 7... Bxc3+ { Black takes the chance he has to double our pawns,
but in return White receives the bishop pair. } 8. bxc3 { [%csl
Gc1,Ge2,Rc3,Rc2,Gb5,Rc7] The activity of the knight on b5 is more important
than a slight structural weakening. } 8... Kd8 { [%cal Gd8c7][%csl Rd8] } (
{ This is the only way black can defend c7. } 8... Qe5 { runs into } 9. f4
{ , etc. Now White's compensation for the pawn includes that Black cannot
castle and that his king is stuck in the centre. }) 9. O-O $16 { [%cal
Ge2f3,Gf1e1][%csl Re4,Rd8,Ge2,Gc1] White has pretty much completed his
development and has a clear advantage. In exchange for a pawn, White has
developed, castled, got the bishop pair, Black's queen is exposed (which
means White can gain more time on it within the next few moves) and most
importantly, Black's king is stuck in the centre and he can't castle. Next
White will play Re1, Bf3 etc. with a wonderful position. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "5. Black's natural"]
[Black "4... Bc5: 6...Qf6"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223009"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Bc5
{ [%csl Rd4] This natural developing bishop move is the most common one in
the position. Black takes play into one of the two chief Scotch
battlegrounds } ( { with the other being } 4... Nf6) { . Black develops and
applies pressure on d4, while not allowing the e5 push (as in the ...Nf6
variation). The structures and play in this variation tend to be more
orthodox and 'normal' than the ...Nf6 variation (which can lead to very
unusual positions). White can usually rely on simple and quick development
to get him a good game, without too much fear of Black playing some wacky
idea which could throw you off. } ( { White has a number of decent options
here: the eccentric } 4... Bc5 5. Nf5 $5 { , }) ( { solid } 4... Bc5 5. Be3
{ , }) (4... Bc5 5. c3 { , }) (4... Bc5 5. Nxc6) ( { and then finally, my
choice, } 4... Bc5 5. Nb3 { . I discarded 5. Nf5!? because it relies too
much on surprise value to be played regularly. My problem with 5. Nxc6 is
that it leads to queen exchanges too quickly - while some players might
like this, others would prefer to avoid it at all costs. 5. c3 is too
objectively weak to be recommended. 5. Be3 is a very decent option of
course, especially considering it is the most popular move, but I finally
settled on 5. Nb3. }) 5. Nb3 { [%cal Bc1e3,Be3g5,Bd1e2,Bf1d3,Gd7d5][%csl
Rc5] My choice has the benefit being the third most popular move for White,
meaning that many players will be slightly less prepared for it. White
retreats with tempo, attacking Black's bishop and he intends to develop
rapidly. I chose this variation since I believe it is one of the best
objectively, it leads to interesting yet 'relatively orthodox' positions
compared to 4... Nf6. and White's play is fairly easy to understand and
play. In general, White aims for quick development. He can opt for long
castling or short castling - it depends on the position. White has two
standard piece setups which I'll be recommending in this variation: Qe2 and
Be3 (which is best played when ...d5 isn't a threat) and Bg5 + Bd3 followed
by short castles (which is White's best option when ... d5 is a very real
possibility). The pawn structure here should be familiar to many players as
it can arise out of a number of openings - notably, the Philidor. White
gets a bit more space and central control while Black gets play down the
e-file and the possibility to carry out either the ...f5 or ...d5 breaks.
White usually wants to develop rapidly, protect the centre and then
gradually advance the kingside pawns and possibly (later) play the e5
break. An alternate idea is sometimes exploiting the d5 outpost with
Nc3-d5. } 5... Bb6 { The bishop retreats of course - b6 is its best square
since it exerts some pressure along the a7-g1 diagonal. } 6. Nc3 { [%csl
Gc3] Natural development. } 6... Qf6 $6 { [%cal Gf6f2,Gb6f2][%csl Rf2] A
strange idea and one which is actually quite popular to my great surprise.
} 7. Qe2 { [%cal Ge2f2,Bc1e3,Ge2e3,Be3b6] Our queen is well-placed on e2
where it supports Be3. I'm not certain what the function of Black's queen
is on f6 and I believe it's misplaced. } 7... Nge7 8. Be3 d6 9. O-O-O $14 {
[%cal Be3b6,Bg2g3,Bf2f4] I think Black's queen is misplaced. White will
follow 'standard procedure' in this position: take on b6 soon and then
begin to advance the kingside pawns. Black's queen might even become a
target of these advances. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "6. Black's natural 4..."]
[Black "Bc5: 6...d6 and ...Nge7 Plan"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223007"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Bc5
{ This natural developing bishop move is the most common one in the
position. Black takes play into one of the two chief Scotch battlegrounds }
( { with the other being } 4... Nf6) { . Black develops and applies
pressure on d4, while not allowing the e5 push (as in the ...Nf6
variation). The structures and play in this variation tend to be more
orthodox and 'normal' than the ...Nf6 variation (which can lead to very
unusual positions). White can usually rely on simple and quick development
to get him a good game, without too much fear of Black playing some wacky
idea which could throw you off. } ( { White has a number of decent options
here: the eccentric } 4... Bc5 5. Nf5 $5 { , }) ( { solid } 4... Bc5 5. Be3
{ , }) (4... Bc5 5. c3 { , }) (4... Bc5 5. Nxc6) ( { and then finally, my
choice, } 4... Bc5 5. Nb3 { . I discarded 5. Nf5!? because it relies too
much on surprise value to be played regularly. My problem with 5. Nxc6 is
that it leads to queen exchanges too quickly - while some players might
like this, others would prefer to avoid it at all costs. 5. c3 is too
objectively weak to be recommended. 5. Be3 is a very decent option of
course, especially considering it is the most popular move, but I finally
settled on 5. Nb3. }) 5. Nb3 { [%cal Bb3c5][%csl Bc5] My choice has the
benefit being the third most popular move for White, meaning that many
players will be slightly less prepared for it. White retreats with tempo,
attacking Black's bishop and he intends to develop rapidly. I chose this
variation since I believe it is one of the best objectively, it leads to
interesting yet 'relatively orthodox' positions } ( { compared to } 5. Nb3
Nf6) { and White's play is fairly easy to understand and play. In general,
White aims for quick development. He can opt for long castling or short
castling - it depends on the position. White has two standard piece setups
which I'll be recommending in this variation: Qe2 and Be3 (which is best
played when ...d5 isn't a threat) and Bg5 + Bd3 followed by short castles
(which is White's best option when ... d5 is a very real possibility). The
pawn structure here should be familiar to many players as it can arise out
of a number of openings - notably, the Philidor. White gets a bit more
space and central control while Black gets play down the e-file and the
possibility to carry out either the ...f5 or ...d5 breaks. White usually
wants to develop rapidly, protect the centre and then gradually advance the
kingside pawns and possibly (later) play the e5 break. An alternate idea is
sometimes exploiting the d5 outpost with Nc3-d5. } 5... Bb6 { The bishop
retreats of course - b6 is its best square since it exerts some pressure
along the a7-g1 diagonal. } 6. Nc3 { Natural development. } 6... d6 { Black
can either develop the knight immediately or first push his pawn to d6.
Both have their advantages. 6... d6 is more flexible and retains the
possibility of castling both ways. It also avoids a possible early Bg5 pin
against the knight on f6. 6... d6 can lead to a plan of ...Nge7 as well,
instead of the standard ...Nf6. 6... d6 has the major disadvantage of
nullifying the threat of the ...d5 breaks. This is one of Black's chief
ideas after 6... Nf6. } 7. Qe2 { [%cal Bc1e3,Ge3b6,Be1c1] This is White's
standard idea which is often also employed against 6... Nf6. The reason I
didn't recommend it in that case was because of a quick ...d5 by Black.
Here, however, this isn't a problem since Black already wasted a tempo with
...d6. White intends to play Be3, developing his bishop. Moving the queen
to e2 also prepares long-castling in the future. } 7... Nge7 { [%cal
Bf7f5,Ge7f5][%csl Gf5] This move is Black's most popular choice and
showcases the flexibility of ...d6. Black doesn't want his knight on f6 to
block the f-pawn - he intends to play ...f5. } 8. Be3 { Standard
development. Black's bishop is an irritating piece so it benefits White to
exchange it. } 8... O-O 9. O-O-O { [%cal Bf2f4,Bg2g4][%csl Gc1] White's
position is perfectly suited for long-castling. Not only would short-side
castling be a few moves away, White's king is perfectly safe on the
queenside and it allows for a possible future kingside attack - White
intends to roll his f- and g-pawns forward in the future. } 9... f5 { Black
carries out his active-looking pawn break, but the fun is short-lived: }
10. exf5 $1 { Although it appears that one of Black's minor pieces will be
very active on f5, this is merely an illusion, as the next few moves will
show. } 10... Bxf5 { ...Nxf5 is met similarly and isn't much better. White
will take on b6 and then prepare to roll his kingside pawns forward,
kicking the knight back at the same time. } 11. Bxb6 axb6 12. a3 $14 {
[%cal Ga3b4,Be2d2,Bf2f4,Bh2h3,Bg2g4][%csl Gb4,Rf5,Rg8] A very strong
prophylactic move preventing any black ...Nb4 intrusions. Black seems to
have a pretty position, but the problem is that he is stuck for a plan.
White's idea is simple - he will play Qd2 and then march his kingside pawns
forward, f4, g4 and so on. Black has no equivalent plan - his queenside
pawns are hamstrung by the doubled b-pawns. I find White's position to be
very pleasant and safe here. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "7. Black's natural 4..."]
[Black "Bc5: 6...d6 and ...Nf6 Plan"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223008"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Bc5
{ This natural developing bishop move is the most common one in the
position. Black takes play into one of the two chief Scotch battlegrounds }
( { with the other being } 4... Nf6) { . Black develops and applies
pressure on d4, while not allowing the e5 push (as in the ...Nf6
variation). The structures and play in this variation tend to be more
orthodox and 'normal' than the ...Nf6 variation (which can lead to very
unusual positions). White can usually rely on simple and quick development
to get him a good game, without too much fear of Black playing some wacky
idea which could throw you off. } ( { White has a number of decent options
here: the eccentric } 4... Bc5 5. Nf5 $5 { , }) ( { solid } 4... Bc5 5. Be3
{ , }) (4... Bc5 5. c3 { , }) (4... Bc5 5. Nxc6) ( { and then finally, my
choice, } 4... Bc5 5. Nb3 { . I discarded 5. Nf5!? because it relies too
much on surprise value to be played regularly. My problem with 5. Nxc6 is
that it leads to queen exchanges too quickly - while some players might
like this, others would prefer to avoid it at all costs. 5. c3 is too
objectively weak to be recommended. 5. Be3 is a very decent option of
course, especially considering it is the most popular move, but I finally
settled on 5. Nb3. }) 5. Nb3 { My choice has the benefit being the third
most popular move for White, meaning that many players will be slightly
less prepared for it. White retreats with tempo, attacking Black's bishop
and he intends to develop rapidly. I chose this variation since I believe
it is one of the best objectively, it leads to interesting yet 'relatively
orthodox' positions } ( { compared to } 5. Nb3 Nf6) { and White's play is
fairly easy to understand and play. In general, White aims for quick
development. He can opt for long castling or short castling - it depends on
the position. White has two standard piece setups which I'll be
recommending in this variation: Qe2 and Be3 (which is best played when
...d5 isn't a threat) and Bg5 + Bd3 followed by short castles (which is
White's best option when ... d5 is a very real possibility). The pawn
structure here should be familiar to many players as it can arise out of a
number of openings - notably, the Philidor. White gets a bit more space and
central control while Black gets play down the e-file and the possibility
to carry out either the ...f5 or ...d5 breaks. White usually wants to
develop rapidly, protect the centre and then gradually advance the kingside
pawns and possibly (later) play the e5 break. An alternate idea is
sometimes exploiting the d5 outpost with Nc3-d5. } 5... Bb6 { The bishop
retreats of course - b6 is its best square since it exerts some pressure
along the a7-g1 diagonal. } 6. Nc3 { Natural development. } 6... d6 { Black
can either develop the knight immediately or first push his pawn to d6.
Both have their advantages. 6... d6 is more flexible and retains the
possibility of castling both ways. It also avoids a possible early Bg5 pin
against the knight on f6. 6... d6 can lead to a plan of ...Nge7 as well,
instead of the standard ...Nf6. 6... d6 has the major disadvantage of
nullifying the threat of the ...d5 breaks. This is one of Black's chief
ideas after 6... Nf6. } 7. Qe2 { [%cal Gc1e3,Ge1c1] This is White's
standard idea which is often also employed against 6... Nf6. The reason I
didn't recommend it in that case was because of a quick ...d5 by Black.
Here, however, this isn't a problem since Black already wasted a tempo with
...d6. White intends to play Be3, developing his bishop. Moving the queen
to e2 also prepares long-castling in the future. } 7... Nf6 { A very
natural developing move. } 8. Be3 { [%cal Be1c1] } 8... Be6 9. O-O-O {
[%cal Bf2f4,Bh2h3,Bg2g4] White is well-placed to castle long. His king is
rather safe on the queenside and it allows him to use his kingside pawns to
expand aggressively. } 9... Qe7 { Black prepares to castle long, but also
keeps the option of kingside castling open. } 10. g3 $1 { [%cal Bf1g2] Here
we see another of White's possible ideas: the kingside fianchetto. The
bishop on g2 fulfills a great role of providing support to the d5 square
(which is useful in the event of Nd5) and it pressures Black's queenside
(e.g. the b7-pawn . Black needs to take some care now if he intends to long
castle. } 10... O-O-O 11. Bxb6 $1 { The open a-file and doubled b-pawns
benefit white. } 11... axb6 12. Bg2 $14 { [%cal
Bh1e1,Gc3d5,Gg2d5,Gd1d5][%csl Ge4,Gg2,Gd5] White has a very pleasant
position here. White plans to finish development and play f4 in the next
couple moves. White must take care to prevent the ...d5 break. This is one
of Black's only real active plans in this position. Additionally, the open
a-file might cause Black some king safety issues later in the game. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "8. Black's natural"]
[Black "4... Bc5: 6...Nf6"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223010"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Bc5
{ This natural developing bishop move is the most common one in the
position. Black takes play into one of the two chief Scotch battlegrounds }
( { with the other being } 4... Nf6) { . Black develops and applies
pressure on d4, while not allowing the e5 push (as in the ...Nf6
variation). The structures and play in this variation tend to be more
orthodox and 'normal' than the ...Nf6 variation (which can lead to very
unusual positions). White can usually rely on simple and quick development
to get him a good game, without too much fear of Black playing some wacky
idea which could throw you off. } ( { White has a number of decent options
here: the eccentric } 4... Bc5 5. Nf5 $5 { , }) ( { solid } 4... Bc5 5. Be3
{ , }) (4... Bc5 5. c3 { , }) (4... Bc5 5. Nxc6) ( { and then finally, my
choice, } 4... Bc5 5. Nb3 { . I discarded 5. Nf5!? because it relies too
much on surprise value to be played regularly. My problem with 5. Nxc6 is
that it leads to queen exchanges too quickly - while some players might
like this, others would prefer to avoid it at all costs. 5. c3 is too
objectively weak to be recommended. 5. Be3 is a very decent option of
course, especially considering it is the most popular move, but I finally
settled on 5. Nb3. }) 5. Nb3 { My choice has the benefit being the third
most popular move for White, meaning that many players will be slightly
less prepared for it. White retreats with tempo, attacking Black's bishop
and he intends to develop rapidly. I chose this variation since I believe
it is one of the best objectively, it leads to interesting yet 'relatively
orthodox' positions } ( { compared to } 5. Nb3 Nf6) { and White's play is
fairly easy to understand and play. In general, White aims for quick
development. He can opt for long castling or short castling - it depends on
the position. White has two standard piece setups which I'll be
recommending in this variation: Qe2 and Be3 (which is best played when
...d5 isn't a threat) and Bg5 + Bd3 followed by short castles (which is
White's best option when ... d5 is a very real possibility). The pawn
structure here should be familiar to many players as it can arise out of a
number of openings - notably, the Philidor. White gets a bit more space and
central control while Black gets play down the e-file and the possibility
to carry out either the ...f5 or ...d5 breaks. White usually wants to
develop rapidly, protect the centre and then gradually advance the kingside
pawns and possibly (later) play the e5 break. An alternate idea is
sometimes exploiting the d5 outpost with Nc3-d5. } 5... Bb6 { The bishop
retreats of course - b6 is its best square since it exerts some pressure
along the a7-g1 diagonal. } 6. Nc3 { Natural development. } 6... Nf6 {
[%cal Bd7d5,Gf6d5] Black can either develop the knight immediately or first
push his pawn to d6. Both have their advantages. 6... d6 is more flexible
and retains the possibility of castling both ways. It also avoids a
possible early Bg5 pin against the knight on f6. 6... d6 can lead to a plan
of ...Nge7 as well, instead of the standard ...Nf6. 6... d6 has the major
disadvantage of nullifying the threat of the ...d5 breaks. This is one of
Black's chief ideas after 6... Nf6. } 7. Bg5 { [%cal Gg5d8][%csl Gd5,Rf6]
As mentioned on the previous note, the problem with the more popular move
7. Qe2 is that Black can play a quick ...d5 (since our queen no longer
covers that square). Instead, I intend to modify White's setup to one which
is based on short castling. The bishop on g5 fulfills an active pinning
role and adds indirect support to the d5-square. } 7... h6 8. Bh4 O-O 9.
Bd3 { [%cal Gd3e4,Be1g1][%csl Ge4] } ( { The bishop develops, thus
preparing short castles, and crucially offers protection to the e4-pawn.
Note that } 9. Bd3 d5 $2 { fails because of } 10. Nxd5 { . }) 9... d6 10.
O-O $11 { [%cal Bd1d2,Bg1h1,Bf2f4,Ba1e1,Bc3a4,Ba4b6][%csl Rb6] A fairly
standard position for this variation has arisen. This line is probably
Black's best bet after 4... Bc5 - the position is very close to equal,
although I still certainly would play White over Black here. White should
complete development and play in the centre of the next few moves. Qd2,
Kh1, Rd1/e1, f4 are all very possible. If Black doesn't play ...a5 or ...a6
soon then Na4xb6 is a strong idea to gain the bishop pair. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "9. The Sharp Mainline:"]
[Black "4... Nf6 and 5...Bc5"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223011"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Nf6
{ This is only Black's second most popular move, after 4... Bc5, but I
believe it is the biggest challenge to the Scotch. Black develops quickly
and applies rapid pressure on White's e4-pawn. The mainline of 5. Nxc6
followed by 6. e5 leads to highly theoretical and unusual positions where
both good knowledge and creativity thrives. The pawn structures in that
variation are found nowhere else, which makes playing the variation an
interesting challenge. However, I have opted for a different choice for
this repertoire. Instead of going for the ultra-theoretical, ultra-sharp
Mieses variation, I opted for the easier-to-play and understand Four
Knights variation. White defends his e4-pawn simply with 5. Nc3 and plays
from there. } 5. Nc3 { As mentioned, I discarded the mainline Mieses
variation because it was too theoretical to cover adequately in this
course. Instead, I am offering a more practical weapon in the form of the
Four Knights variation. } 5... Bc5 { [%csl Rd4] This is Black's second most
popular choice after 5... Bb4. It makes sense to develop the bishop and
attack the knight at the same time. } 6. Be3 { [%cal Ge3c5,Bd4c6][%csl
Rc5,Rc6,Gd4] Developing and covering the knight. White threatens to win the
bishop with Nxc6 followed by Bxc5. Note that capturing twice on d4 favours
white - the queen on d4 is centralised and untouchable. } 6... Bb6 { [%csl
Gb6] The most natural retreat. The other move, 6... Bb4, simply appears to
be a worse version of 5... Bb4. } 7. Qd2 { [%cal Be1c1,Gd2e3][%csl Ge3,Gd2]
A good square for the queen. White prepares long castling. } 7... O-O 8.
O-O-O { [%cal Bf2f3,Bg2g4,Bh2h4] White reaches a kind-of Yugoslav Attack
setup (from the Sicilian Dragon). Black is lacking good queenside
counterplay though - he has to try and make do with the semi-open e-file. }
8... Re8 { [%cal Gf6e4,Ge8e4][%csl Re4] } 9. f3 { [%cal Gf3e4][%csl Ge4]
Supporting e4. } 9... d5 $1 { [%csl Re4] } ( { Black has little choice but
to play actively. After the passive } 9... d6 { white has a free hand to
build a kingside attack. }) 10. exd5 Nxd5 11. Bg5 $14 { [%cal
Gd1d5,Gd2d5,Gc3d5,Gg5d8][%csl Gg5,Rd8,Gd2,Gd1,Gc3,Rd5] White's active and
well-placed pieces secure him the edge. Black needs to take some care not
to allow White's initiative to develop further. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "10. The Sharp Mainline: 4..."]
[Black "Nf6 and 5...Bb4 Omitting ...d5"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223012"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Nf6
{ [%csl Re4] This is only Black's second most popular move, after 4... Bc5,
but I believe it is the biggest challenge to the Scotch. Black develops
quickly and applies rapid pressure on White's e4-pawn. The mainline of 5.
Nxc6 followed by 6. e5 leads to highly theoretical and unusual positions
where both good knowledge and creativity thrives. The pawn structures in
that variation are found nowhere else, which makes playing the variation an
interesting challenge. However, I have opted for a different choice for
this repertoire. Instead of going for the ultra-theoretical, ultra-sharp
Mieses variation, I opted for the easier-to-play and understand Four
Knights variation. White defends his e4-pawn simply with 5. Nc3 and plays
from there. } 5. Nc3 { [%cal Gc3e4][%csl Ge4] As mentioned, I discarded the
mainline Mieses variation because it was too theoretical to cover
adequately in this course. Instead, I am offering a more practical weapon
in the form of the Four Knights variation. } 5... Bb4 { [%cal
Gb4e1,Gf6e4][%csl Rc3,Re1,Re4] The main move here. Black develops and
simultaneously applies unpleasant pressure on e4. } 6. Nxc6 { [%cal Bf1d3]
} ( { The knight is exchanged so that Bd3 is possible - } 6. Bd3 $2 Nxd4 {
. }) 6... bxc6 { Note, once again, that the ...dxc6 endgame favours white
hugely. White in effect has an extra pawn on the kingside, since Black's
doubled pawns can never create a passed pawn. } 7. Bd3 { [%cal
Gd3e4,Be1g1][%csl Ge4] Developing and covering e4. } 7... O-O { In many
cases, this move transposes to ...d5 one move later, but sometimes Black
wants to just forego ...d5 altogether. } 8. O-O Re8 { [%cal
Ge8e4,Gf6e4,Gb4c3][%csl Re4] Black decides to attack e4 instead of
liquidating it. } 9. Bg5 { [%cal Gg5d8][%csl Rf6,Rd8] Defending e4
indirectly like this is probably White's best option. The pin is irritating
for Black and White develops at the same time. } 9... h6 10. Bh4 $14 {
[%cal Gh4d8][%csl Rf6,Rd8,Re4] } ( { From this position, Black has a
handful of options but White's position is comfortable in any case. Black
can go pawn-grabbing here with } 10. Bh4 g5 { followed by ...Bxc3 and
...Nxe4, but this is risky. White's queen lands on h5 in those variations
and Black needs to take some care or give the pawn back. }) *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "11. The Sharp Mainline: 4..."]
[Black "Nf6 and 5...Bb4 Mainline"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223014"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Nf6
{ This is only Black's second most popular move, after 4... Bc5, but I
believe it is the biggest challenge to the Scotch. Black develops quickly
and applies rapid pressure on White's e4-pawn. The mainline of 5. Nxc6
followed by 6. e5 leads to highly theoretical and unusual positions where
both good knowledge and creativity thrives. The pawn structures in that
variation are found nowhere else, which makes playing the variation an
interesting challenge. However, I have opted for a different choice for
this repertoire. Instead of going for the ultra-theoretical, ultra-sharp
Mieses variation, I opted for the easier-to-play and understand Four
Knights variation. White defends his e4-pawn simply with 5. Nc3 and plays
from there. } 5. Nc3 { As mentioned, I discarded the mainline Mieses
variation because it was too theoretical to cover adequately in this
course. Instead, I am offering a more practical weapon in the form of the
Four Knights variation. } 5... Bb4 { The main move here. Black develops and
simultaneously applies unpleasant pressure on e4. } 6. Nxc6 ( { The knight
is exchanged so that Bd3 is possible - } 6. Bd3 $2 Nxd4 { . }) 6... bxc6 {
Note, once again, that the ...dxc6 endgame favours White hugely. White in
effect has an extra pawn on the kingside, since Black's doubled pawns can
never create a passed pawn. } 7. Bd3 { [%cal Bd3e4][%csl Be4] Developing
and covering e4. } 7... d5 { [%cal Gd5e4,Be4d5][%csl Gd5,Re4] By playing
like this Black intends to take the centre for himself while ridding White
of the slightly weak e4-pawn. The alternative is to try and pressure e4
along the semi open e-file. } 8. exd5 (8. e5 { is playable, but I don't
believe it is objectively as good as this. White gets more than sufficient
winning chances here. }) 8... cxd5 ( { Note that recapturing with the
knight instead can be met with the sacrificial } 8... Nxd5 9. O-O { .
Taking the pawn on c3 in that situation would be very risky because of
Black's central king - Ba3 would mean the king wouldn't be getting to
safety any time soon. }) 9. O-O O-O 10. h3 { [%cal Gh3g4,Bd1f3][%csl Gg4]
In recent times, some of the world's elite have been giving the Scotch Four
Knights a go and this has been their choice. 10. h3 is a nice prophylactic
move which prevents any g4 intrusions and clears the way for White's queen
on f3. } 10... c6 { Black solidifies his pawn on d5. } 11. Qf3 $14 { [%cal
Bc1f4,Bc3e2,Bc2c4,Gc4d5][%csl Rd5] White has achieved the setup he has been
aiming for and has a good position. The queen is active on f3 and can join
the fight on the kingside or pressure the centre. The queen on f3 also
frees up the d1 square for one of White's rooks and allows the possibility
of Bg5xf6 (doubling white's f-pawns). Although the position may be very
close to equal, White enjoys a fantastic success rate of nearly 62%. From
the games I've examined, White has a very clear and concise plan. Firstly,
he should complete development with Bf4. Next the rooks come to d1 and
maybe e1 (depending on whether the bishop on b4 moves). Then white plays
Ne2 with the idea of playing c4. This pawn break puts serious pressure on
Black's central d5-pawn and gives White good play. If Black puts his rook
on the b-file to attack b2, simplest for White is just to play b3. Note the
importance of the e-file in this position, since it is the only open file
at the moment. Since this is small 'tabiya' for this variation, I would
recommend looking at some master games from this position and additionally
playing a few training games of your own either online or against a
computer. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "12. The Sharp Mainline: 4... Nf6 and"]
[Black "5...Bb4 7...d5 Queen exchange"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/223013"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for his bishop and queen, while
preparing rapid development and kingside castling. } 1... e5 { Black avoids
the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { A natural move - White
attacks e5 and develops. By developing his kingside knight, White is one
move closer to short castling. } 2... Nc6 ( { Black replies similarly - he
covers the pawn and develops. However, Black has other options at his
disposal - most notably } 2... Nf6 { , the Petroff Defence }) ( { and }
2... d6 { , the Philidor Defence. Both of these openings will be covered in
the final lines of this course. }) 3. d4 { White's third most popular move
is 3. d4, after 3. Bb5 (the Ruy Lopez) and 3. Bc4 (the Italian). Firstly,
some people might wonder why one would want to play the Scotch Game. I see
a handful of benefits to playing the Scotch over the alternatives: 1. It's
less common than both the Ruy Lopez and Italian game. This means that your
opponents are less likely to be thoroughly-prepared for it and they should
of course have less experience in it as well. 2. Unlike the Ruy Lopez (and
the Italian to a lesser extent), Black's options are very limited. While
black in the Ruy Lopez can choose from almost a dozen different defences,
the Scotch boils down to two main lines. This makes the Scotch a bit easier
to learn since there are fewer sidelines. 3. The Scotch can lead to a
variety of different, interesting positions and structures which are hard
to come by in different openings. This means that the Scotch should
certainly appeal to creative and experimental chess players. So what is the
idea behind 3. d4? Basically it boils down to the centre. In the Ruy Lopez
or Italian, White's plan is often to play d4 after lengthy preparation with
c3 and so on. This means that White can recapture on d4 with the pawn
(which is superior to capturing with the knight) but the downside is that
Black is often not forced to take on d4! He typically would guard the e5
strongpoint and would very rarely relinquish control of the e5 pawn since
it is his only real central foothold. } (3. d4 { on the other hand takes a
very different approach. White makes his central break early which forces
Black to play } 3... exd4 (3... d6 { is not good, which will be
demonstrated later. }) { After } 4. Nxd4 { White will have an extra pawn in
the centre - e4 - while Black was forced to exchange his e5 pawn. As a
result of this e4 pawn, White has better control over the centre. }) { This
does come at a cost however. White spends one tempo to carry out this d4
break. Instead of developing his bishop and quickly castling, white has
opted for a central break which grants him a larger centre. In the
mainlines, Black tries to exploit this loss of time by quickly generating
threats against both the undefended e4-pawn and the unstable knight on d4.
Therefore, after 4. Nxd4 Black's two main choices are ...Bc5 and ...Nf6.
These will be covered in the following two chapters while this chapter will
examine what White should do when Black deviates earlier. } 3... exd4 { The
obvious and best move. Black is forced to cede the centre since ...d6 isn't
good, as was demonstrated previously. } 4. Nxd4 ( { To be totally honest,
the Scotch Game only technically starts after this move, not 3. d4. White
had a couple of options to deviate here, such as the Scotch gambit - } 4.
Bc4 { , }) ( { and the Goring Gambit - } 4. c3 { . Neither of those will be
covered here, as this is a course dedicated to the Scotch game. }) 4... Nf6
{ This is only Black's second most popular move, after 4... Bc5, but I
believe it is the biggest challenge to the Scotch. Black develops quickly
and applies rapid pressure on White's e4-pawn. The mainline of 5. Nxc6
followed by 6. e5 leads to highly theoretical and unusual positions where
both good knowledge and creativity thrives. The pawn structures in that
variation are found nowhere else, which makes playing the variation an
interesting challenge. However, I have opted for a different choice for
this repertoire. Instead of going for the ultra-theoretical, ultra-sharp
Mieses variation, I opted for the easier-to-play and understand Four
Knights variation. White defends his e4-pawn simply with 5. Nc3 and plays
from there. } 5. Nc3 { As mentioned, I discarded the mainline Mieses
variation because it was too theoretical to cover adequately in this
course. Instead, I am offering a more practical weapon in the form of the
Four Knights variation. } 5... Bb4 { The main move here. Black develops and
simultaneously applies unpleasant pressure on e4. } 6. Nxc6 ( { The knight
is exchanged so that Bd3 is possible - } 6. Bd3 $2 Nxd4 { . }) 6... bxc6 {
Note, once again, that the ...dxc6 endgame favours White hugely. White in
effect has an extra pawn on the kingside, since Black's doubled pawns can
never create a passed pawn. } 7. Bd3 { Developing and covering e4. } 7...
d5 { By playing like this Black intends to take the centre for himself
while ridding White of the slightly weak e4-pawn. The alternative is to try
and pressure e4 along the semi open e-file. } 8. exd5 (8. e5 { is playable,
but I don't believe it is objectively as good as this. White gets more than
sufficient winning chances here. }) 8... Qe7+ { [%cal Ge7e1][%csl Re1]
Black has this slightly annoying check option which takes White virtually
by force into an endgame. Although some players might not like this, the
good news is that the endgame is a bit better for White. } 9. Qe2 { The
only real option to block the check - moving the king is of course far from
ideal. } 9... Qxe2+ 10. Kxe2 { Taking back with the king allows our bishop
to remain active on the d3-square. } 10... Nxd5 { [%cal Gc6b5][%csl Gb5] }
( { Otherwise, after } 10... cxd5 { , } 11. Nb5 { is quite irritating for
Black. Black needs the pawn on c6 to cover the b5-square for the moment. })
11. Nxd5 cxd5 12. Bb5+ { [%csl Re8,Rc6] White should try cause Black's king
some problems before he gets the chance to play ...c6. Now Black has the
slightly unpleasant choice of forfeiting castling or trading bishops and
having a king stuck in the centre of the board. } 12... Bd7 13. Bxd7+ Kxd7
14. Be3 $14 { [%cal Bh1d1,Bd1d3,Ba1d1][%csl Rd7,Gd3,Gd1,Rd5] White retains
some pressure because of Black's precariously placed king. White intends to
double up on the d-file to attack d5. Although the position is close to
equal, White is the only player who has winning chances here. While good
defence for Black will hold, a few small slip-ups can very easily lead to a
white victory. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "13. Black avoids the"]
[Black "Scotch: Philidor 1"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/4602583"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for White's bishop and queen,
while preparing rapid development and kingside castling. } 1... e5 { Black
avoids the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { So far all this should
be familiar to you, of course. However instead of the natural and most
common, 2... Nc6, Black can opt for either 2... d6 or 2... Nf6. These
defences, known as the Philidor and the Petroff respectively, are
significantly rarer than Nc6, but I thought they should be covered for the
sake of completeness. } 2... d6 { The Philidor Defence - Black supports his
e5 pawn with a pawn, instead of the knight. The Philidor is frequently
essayed by players who prefer quiet and positional games - often Black will
follow up with ...Nf6, ...Nd7 ...Be7, ...c6 and ...O-O. His setup is very
flexible, albeit not that ambitious. Alternatively, he can cede the centre
- after 3. d4 - and attempt to generate counterplay down the e-file. } 3.
d4 { [%csl Gd4,Ge4] } ( { One of the main downsides of Black's last moves
is that ...d6 has hardly any influence on the centre. This gives white a
free hand to play the space-gaining 3. d4. At this stage, Black faces a
choice: he can either surrender the centre with } 3. d4 exd4 { and seek
central counterplay later, }) ( { or he can try support his e5-pawn bastion
with } 3. d4 Nd7 { . }) 3... Nd7 { [%cal Gd7e5][%csl Ge5] } ( { With this
move Black intends to hold on to the little slice of the centre he has -
the e5-pawn. Black plans to develop simply and soundly, with move such as
...Be7, ...Nf6, ...O-O, ...c6 etc. It's important to note that one of
Black's primary alternatives, } 3... Nf6 { , is bound to transpose to
either 3...exd4 or 3... Nd7 after } 4. Nc3 { . }) 4. Nc3 { [%cal
Bf1c4,Be1g1] Natural development. } 4... Ngf6 { Against Black's setup, I
have decided to recommend a simple, natural but strong setup based on Bc4,
O-O and a4. It requires very little theoretical knowledge and risks little
compared to the more flamboyant variations which usually involve g4. } 5.
Bc4 { [%csl Gc4] A good, natural square for the bishop. } 5... Be7 6. O-O
O-O 7. a4 { [%cal Ga4b5,Ba4a5,Gd1d4,Be5d4,Bf1e1,Bc1e3,Bf3h4,Bh4f5][%csl
Gb5,Gd4,Gf5] This move is played in order to curb black's intended
queenside expansion with ...a6 and ...b5 by playing a5 to stop it. In
general, if Black captures on d4 in this position, it is safe to recapture
with our queen since there is no knight coming to c6 to harass it. White
should continue development with Re1 and Be3. From there, his plan could go
in any number of directions - one possible idea is a knight manoeuvre to f5
via h4. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "14. Black avoids the"]
[Black "Scotch: Philidor 2"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/4602584"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for White's bishop and queen,
while preparing rapid development and kingside castling. } 1... e5 { Black
avoids the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { So far all this should
be familiar to you, of course. However instead of the natural and most
common, 2... Nc6, Black can opt for either 2... d6 or 2... Nf6. These
defences, known as the Philidor and the Petroff respectively, are
significantly rarer than Nc6, but I thought they should be covered for the
sake of completeness. } 2... d6 { The Philidor Defence - Black supports his
e5 pawn with a pawn, instead of the knight. The Philidor is frequently
essayed by players who prefer quiet and positional games - often Black will
follow up with ...Nf6, ...Nd7 ...Be7, ...c6 and ...O-O. His setup is very
flexible, albeit not that ambitious. Alternatively, he can cede the centre
- after 3. d4 - and attempt to generate counterplay down the e-file. } 3.
d4 ( { One of the main downsides of Black's last moves is that ...d6 has
hardly any influence on the centre. This gives white a free hand to play
the space-gaining 3. d4. At this stage, Black faces a choice: he can either
surrender the centre with } 3. d4 exd4 { and seek central counterplay
later, }) ( { or he can try support his e5-pawn bastion with } 3. d4 Nd7 {
. }) 3... exd4 { With this move, Black loses a large chunk of his central
influence, but he does gain the half-open e-file which will often be used
in an attempt to generate counterplay. } 4. Nxd4 { [%csl Gd4,Ge4] } 4...
Nf6 { [%csl Re4] Developing and attacking e4. } 5. Nc3 { [%cal Gc3e4][%csl
Ge4] } ( { White protects e4 of course. This position can be reached
through a variety of different move orders. Black has two possible
development schemes here at his disposal: --- 1. The usual Philidor-style
natural } 5. Nc3 Be7 { development. This has the advantage of saving some
time and keeping the king safer. On the other hand, the bishop might not be
quite as active as it would be on the long diagonal (a1-h8). This will be
covered in a bit more depth as it is more common. }) ( { 2. The
Dragon-style } 5. Nc3 g6 { fianchetto - this is significantly rarer than
...Be7 plans. It tends to be a bit slower, which can potentially get
Black's king into some trouble. Additionally, and very importantly, moving
the pawn to ...g6 gives white a 'hook' to latch onto and dark squares to
exploit. This means that White's plan will often be in the spirit of the
Yugoslav Attack (in the Sicilian Dragon). We will play Be3, Qd2, f3 and
possibly long castles. h4-h5 is one idea to open up Black's king and it's
also common trade off Black's key kingside defender with Be3-h6. Black
lacks his usual counterplay that is typical of the dragon - this is because
the wrong file is open (White will castle long and the c-file is closed,
which would normally be the basis for black's counterattack). }) 5... Be7 {
Black's safer option - he develops rapidly and gets his king safe, without
allowing for a big white kingside attack. } 6. Be2 { [%cal Be1g1] } 6...
O-O 7. O-O ( { If you intend to launch a kingside attack, an alternative is
the flexible } 7. Bf4 { followed by long castling. }) 7... Re8 8. Re1 $14 {
[%cal Bc1f4,Be2f1,Ge1e4][%csl Ge4] It makes sense for White to follow suit
and put his rook on the same file. I'd prefer not to rush my pawn to f4,
which could end up leaving e4 exposed. Next White will most likely play Bf4
and play along the central files. His space advantage and well-developed
pieces should grant him an edge. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "15. Black avoids the"]
[Black "Scotch: Petroff 1"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/4602586"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for White's bishop and queen,
while preparing rapid development and kingside castling. } 1... e5 { Black
avoids the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { So far all this should
be familiar to you, of course. However instead of the natural and most
common, 2... Nc6, Black can opt for either 2... d6 or 2... Nf6. These
defences, known as the Philidor and the Petroff respectively, are
significantly rarer than Nc6, but I thought they should be covered for the
sake of completeness. } 2... Nf6 { [%cal Gf6e4][%csl Re4] This is the
Petroff defence - a staple opening amongst the chess elite and one which is
known for its drawish tendencies. It is certainly rarer at the lower
levels, but I covered it here for completness sake. } 3. Nxe5 d6 ( { Note
that } 3... Nxe4 $2 { is a blunder of course because of } 4. Qe2 { . }) 4.
Nf3 Nxe4 5. Nc3 { [%cal Be4c3,Bd2c3][%csl Gf1,Gc1] } ( { Historically the
main move is } 5. d4 { , but in recent times players have migrated to this
interesting and high-scoring move. White's idea is to create an imbalance
(doubled c-pawns) which facilitates rapid development and allows White to
develop an initiative. }) 5... Nf6 { Occasionally Black is worried about
the rapid development White gets after the knight exchange so he retreats
his knight. The problem now is that Black is two tempi behind, so this
allows White to develop a nice initiative. } 6. d4 { [%csl Gf3,Gc3,Gd4] }
6... Be7 { Black needs to develop and get his king safe quickly. } 7. Bd3 {
[%cal Bd3c4,Bd6d5][%csl Gd3] } ( { The bishop is better here than on c4 as
after } 7. Bc4 { it would get shut down by } 7... d5 { . }) 7... O-O 8. h3
$1 { [%cal Gh3g4,Be1g1][%csl Gg4,Gd3,Gc3,Gd4,Gf3] } $14 { This is a strong
prophylactic move which kills any black idea of ...‚ôóg4 followed possibly
by ...‚ôóh5-g6 which trades off our good light-squared bishop. Next White
will castle while enjoying his space advantage and lead in development. } *

[Event "Short & Sweet: The Scotch Game"]
[Site "Main Level"]
[Date "????.??.??"]
[Round "?"]
[White "16. Black avoids the"]
[Black "Scotch: Petroff 2"]
[Result "*"]
[SourceTitle "Main Level"]
[Source "Chessable.com"]
[Comment "short-sweet-the-scotch-game/course/5479, variation/4602587"]

1. e4 { White's most popular first move attracts World champions and
novices alike. Chess newcomers naturally gravitate towards it while many
World Championships were decided by it. Fischer's move, together with 1.
d4, has the simple plan of taking over the whole centre by playing d4 on
the next move. In addition, it opens lines for White's bishop and queen,
while preparing rapid development and kingside castling. } 1... e5 { Black
avoids the wild, unbalanced Sicilian or the exotic French and Caro-Kann and
instead heads for the solid Open Games. } 2. Nf3 { So far all this should
be familiar to you, of course. However instead of the natural and most
common, 2... Nc6, Black can opt for either 2... d6 or 2... Nf6. These
defences, known as the Philidor and the Petroff respectively, are
significantly rarer than Nc6, but I thought they should be covered for the
sake of completeness. } 2... Nf6 { This is the Petroff defence - a staple
opening amongst the chess elite and one which is known for its drawish
tendencies. It is certainly rarer at the lower levels, but I covered it
here for completness sake. } 3. Nxe5 d6 ( { Note that } 3... Nxe4 $2 { is a
blunder of course because of } 4. Qe2 { . }) 4. Nf3 Nxe4 5. Nc3 ( {
Historically the main move is } 5. d4 { , but in recent times players have
migrated to this interesting and high-scoring move. White's idea is to
create an imbalance (doubled c-pawns) which facilitates rapid development
and allows White to develop an initiative. }) 5... Nxc3 { Black takes up
the challenge. } 6. dxc3 { [%cal Bc1e3,Bd1d2,Be1c1][%csl Rc3,Rc2,Gf1,Gc1]
This is of course the correct recapture. White wants quick development and
open lines (diagonals) for his bishops in exchange for a slight structural
defect. We intend to develop quickly followed by long castling possibly and
a kingside attack. } 6... Be7 7. Be3 { [%cal Bd1d2,Be1c1] The bishop is a
bit less exposed on this square - next White intends Qd2 followed by long
castles. } 7... O-O 8. Qd2 Nc6 9. O-O-O $14 { [%cal Bf1c4,Bg2g4,Bh2h4][%csl
Rg8] White has a very nice and fun position here. He has a decent lead in
development and good squares for all his pieces. His plan is of course to
pawn storm the kingside and attempt to mate Black's king. } *
--- data/test-opening.pgn ---
[Event "Simple Test Opening"]
[Site "Test Course"]
[Date "2024.01.01"]
[White "White"]
[Black "Black"]
[Result "*"]

{This is a simple 4-move opening test. White develops pieces quickly and Black responds classically.}

1.e4 {White opens with the king's pawn, controlling the center and freeing the bishop and queen.} 
1...e5 {Black mirrors White's opening, also controlling the center squares.}
2.Nf3 {White develops the knight, attacking Black's e5 pawn while developing towards the center.} 
2...Nc6 {Black defends the e5 pawn and develops the knight to its best square.} *
--- data/ultra-simple.pgn ---
[Event "Working Test"]
[Site "Test"]
[Date "2025.01.01"]
[White "Student"]
[Black "Computer"]
[Result "*"]

{Simple working test.}

1. e4 {King's pawn. [%cal Ge2e4]} 
e5 {Black responds.}

2. Nf3 {Knight development.}
( 2. d4 {Queen's pawn instead. [%cal Gd2d4]} 
exd4 {Black captures.} )

2... Nc6 {Black develops.}

3. Bc4 {Italian Game! [%cal Gf1c4]} *

=== ENGINE FILES ===
--- engine/chess-engine.js ---
// /engine/chess-engine.js - FINAL VERSION

import { Chessground } from '../assets/js/chessground.min.js';

export class ChessEngine {
    constructor(boardElementId, options = {}) {
        this.chess = new Chess();
        this.boardElement = document.getElementById(boardElementId);
        this.board = null;
        this.playerColor = options.playerColor || 'both';
        this.orientation = options.orientation || 'white';
        this.currentLine = null;
        this.currentMoves = [];
        this.moveIndex = 0;
        this.isLineActive = false;
        this.onMoveCallback = null;
        this.onLineCompleteCallback = null;
        this.onComputerMoveCallback = null;
        this.initializeBoard();
        this.setupPromotionHandlers();
        this.cachedDests = null;
        this.lastCalculatedFen = null;
    }
    
    initializeBoard() {
        this.board = Chessground(this.boardElement, {
            orientation: this.orientation,
            movable: {
                color: this.getMovableColor(),
                free: false,
                dests: this.calculateDests()
            },
            draggable: { showGhost: true }
        });
        this.board.set({
            movable: { events: { after: (orig, dest) => this.handleMove(orig, dest) } }
        });
    }

    calculateDests() {
        const dests = new Map();
        
        // Only check squares that have pieces of the current player
        const currentTurn = this.chess.turn(); // 'w' or 'b'
        const board = this.chess.board();
        
        board.forEach((row, rowIndex) => {
            row.forEach((piece, colIndex) => {
                if (piece && piece.color === currentTurn) {
                    const square = String.fromCharCode(97 + colIndex) + (8 - rowIndex);
                    const moves = this.chess.moves({square, verbose: true});
                    if (moves.length) {
                        dests.set(square, moves.map(m => m.to));
                    }
                }
            });
        });
        
        return dests;
    }

    updateBoard() {
        this.board.set({
            fen: this.chess.fen(),
            turnColor: this.getCurrentColor(),
            movable: { color: this.getMovableColor(), dests: this.calculateDests() }
        });
    }
    
    loadLine(lineData, startingFen = null) {
        this.currentLine = lineData;
        this.currentMoves = lineData.moves || [];
        this.moveIndex = 0;
        this.isLineActive = true;
        if (startingFen) { this.chess.load(startingFen); } 
        else { this.chess.reset(); }
        this.updateBoard();
        setTimeout(() => {
            if (this.shouldComputerMoveNow()) { this.playNextComputerMove(); }
        }, 100);
    }
    
    shouldComputerMoveNow() {
        if (!this.isLineActive || this.moveIndex >= this.currentMoves.length || this.playerColor === 'both') {
            return false;
        }
        const currentTurn = this.chess.turn();
        return (this.playerColor === 'white' && currentTurn === 'b') || (this.playerColor === 'black' && currentTurn === 'w');
    }
    
    playNextComputerMove() {
        if (!this.isLineActive || this.moveIndex >= this.currentMoves.length) return false;
        const nextMove = this.currentMoves[this.moveIndex];
        const move = this.chess.move(nextMove, { sloppy: true });
        if (move) {
            this.moveIndex++;
            this.updateBoard();
            if (this.onComputerMoveCallback) this.onComputerMoveCallback(move);
            if (this.moveIndex >= this.currentMoves.length) this.completeCurrentLine();
            return true;
        }
        return false;
    }
    
    validateUserMove(move) {
        if (!this.isLineActive || this.moveIndex >= this.currentMoves.length) {
            return { valid: false, expected: null, isComplete: false };
        }
        const expectedMove = this.currentMoves[this.moveIndex];
        const isCorrect = (move.san === expectedMove);
        if (isCorrect) {
            this.moveIndex++;
            const isComplete = this.moveIndex >= this.currentMoves.length;
            return { valid: true, expected: expectedMove, isComplete: isComplete };
        }
        return { valid: false, expected: expectedMove, isComplete: false };
    }
    
    completeCurrentLine() {
        this.isLineActive = false;
        if (this.onLineCompleteCallback) {
            this.onLineCompleteCallback({ line: this.currentLine, totalMoves: this.currentMoves.length });
        }
    }
    
    getLineProgress() {
        if (!this.currentLine) return { current: 0, total: 0, percentage: 0, isComplete: true };
        return {
            current: this.moveIndex,
            total: this.currentMoves.length,
            percentage: this.currentMoves.length > 0 ? (this.moveIndex / this.currentMoves.length) * 100 : 0,
            isComplete: this.moveIndex >= this.currentMoves.length
        };
    }
    
    resetCurrentLine() {
        if (this.currentLine) { this.loadLine(this.currentLine); }
    }

    // --- NEW FUNCTIONS FOR STEPPING ---
    stepBackward() {
        if (this.moveIndex > 0) {
            this.chess.undo();
            this.moveIndex--;
            this.updateBoard();
            return true;
        }
        return false;
    }

    stepForward() {
        if (this.moveIndex < this.currentMoves.length) {
            const nextMove = this.currentMoves[this.moveIndex];
            if (this.chess.move(nextMove, { sloppy: true })) {
                this.moveIndex++;
                this.updateBoard();
                return true;
            }
        }
        return false;
    }
    
    handleMove(orig, dest) {
        if (!this.canPlayerMove()) { this.updateBoard(); return; }
        const piece = this.chess.get(orig);
        const isPromotion = piece && piece.type === 'p' && ((piece.color === 'w' && dest[1] === '8') || (piece.color === 'b' && dest[1] === '1'));
        if (isPromotion) {
            this.pendingPromotion = { from: orig, to: dest };
            this.showPromotionDialog(piece.color);
            return;
        }
        const move = this.chess.move({ from: orig, to: dest });
        if (move) {
            if (this.isLineActive) {
                const validation = this.validateUserMove(move);
                if (!validation.valid) {
                    this.chess.undo();
                    this.updateBoard();
                } else {
                    this.updateBoard();
                    if (validation.isComplete) {
                        this.completeCurrentLine();
                    } else {
                    if (this.shouldComputerMoveNow()) {
                        setTimeout(() => this.playNextComputerMove(), 300);
                    }
                    }
                }
                if (this.onMoveCallback) this.onMoveCallback(move, validation);
            } else {
                this.updateBoard();
                if (this.onMoveCallback) this.onMoveCallback(move, { valid: true, freePlay: true });
            }
        } else {
            this.updateBoard();
        }
    }
    
    showPromotionDialog(color) { /* ... unchanged ... */ }
    hidePromotionDialog() { /* ... unchanged ... */ }
    handlePromotion(promotionPiece) { /* ... unchanged ... */ }
    setupPromotionHandlers() { /* ... unchanged ... */ }
    
    getCurrentColor() { return this.chess.turn() === 'w' ? 'white' : 'black'; }
    getMovableColor() {
        if (this.playerColor === 'both') return this.getCurrentColor();
        if (this.playerColor === this.getCurrentColor()) return this.getCurrentColor();
        return null;
    }
    canPlayerMove() {
        if (this.playerColor === 'both') return true;
        return this.getCurrentColor() === this.playerColor;
    }
    
    setPlayerColor(color) {
        this.playerColor = color;
        this.updateBoard();
        setTimeout(() => {
            if (this.isLineActive && this.shouldComputerMoveNow()) { this.playNextComputerMove(); }
        }, 100);
    }

    setOrientation(orientation) {
        this.orientation = orientation;
        this.board.set({ orientation: orientation });
    }

    flipBoard() {
        const newOrientation = this.orientation === 'white' ? 'black' : 'white';
        this.setOrientation(newOrientation);
        return newOrientation;
    }
    
    onMove(callback) { this.onMoveCallback = callback; }
    onLineComplete(callback) { this.onLineCompleteCallback = callback; }
    onComputerMove(callback) { this.onComputerMoveCallback = callback; }
}
--- engine/performance-optimizer.js ---
// /performance-patch.js - SAFE Performance Improvements
// Add this file and include it AFTER your existing trainer.js loads

(function() {
    'use strict';
    
    console.log('üîß Applying safe performance patches...');
    
    // Wait for trainer to be ready
    function waitForTrainer() {
        if (window.trainer && window.uiManager) {
            applyPerformancePatches();
        } else {
            setTimeout(waitForTrainer, 50);
        }
    }
    
    function applyPerformancePatches() {
        const trainer = window.trainer;
        const uiManager = window.uiManager;
        
        if (!trainer || !uiManager) {
            console.warn('Trainer or UI Manager not found');
            return;
        }
        
        console.log('‚úÖ Trainer found, applying optimizations...');
        
        // ============================================
        // 1. BATCH UI UPDATES (BIGGEST PERFORMANCE WIN)
        // ============================================
        
        let updateQueue = new Set();
        let isUpdating = false;
        
        function batchUpdate(callback) {
            updateQueue.add(callback);
            
            if (!isUpdating) {
                isUpdating = true;
                requestAnimationFrame(() => {
                    // Execute all queued updates in one frame
                    updateQueue.forEach(cb => {
                        try { cb(); } catch(e) { console.warn('Update error:', e); }
                    });
                    updateQueue.clear();
                    isUpdating = false;
                });
            }
        }
        
        // Patch existing methods to use batching
        const originalUpdateMovesList = uiManager.updateMovesList.bind(uiManager);
        const originalRefreshArrows = uiManager.refreshArrows.bind(uiManager);
        const originalUpdateMoveComment = uiManager.updateMoveComment.bind(uiManager);
        
        uiManager.updateMovesList = function() {
            batchUpdate(originalUpdateMovesList);
        };
        
        uiManager.refreshArrows = function() {
            batchUpdate(originalRefreshArrows);
        };
        
        uiManager.updateMoveComment = function() {
            batchUpdate(originalUpdateMoveComment);
        };
        
        // ============================================
        // 2. OPTIMIZE CHESSGROUND SETTINGS
        // ============================================
        
        if (trainer.chessEngine && trainer.chessEngine.board) {
            // Faster animations for snappier feel
            trainer.chessEngine.board.set({
                animation: {
                    enabled: true,
                    duration: 150  // Reduced from default 200ms
                }
            });
            console.log('‚úÖ Board animations optimized');
        }
        
        // ============================================
        // 3. CACHE EXPENSIVE OPERATIONS
        // ============================================
        
        let arrowCache = new Map();
        let moveListCache = '';
        
        // Cache arrow computations
        const originalRefreshArrowsImpl = originalRefreshArrows;
        uiManager.refreshArrows = function() {
            const line = trainer.getCurrentLine();
            const progress = trainer.getProgress().chessProgress;
            const cacheKey = `${line?.id || 'none'}-${progress.current}-${trainer.chessEngine.playerColor}`;
            
            // Return early if already computed
            if (arrowCache.has(cacheKey)) {
                return;
            }
            
            batchUpdate(() => {
                originalRefreshArrowsImpl();
                arrowCache.set(cacheKey, true);
                
                // Keep cache size manageable
                if (arrowCache.size > 50) {
                    const firstKey = arrowCache.keys().next().value;
                    arrowCache.delete(firstKey);
                }
            });
        };
        
        // Cache move list if unchanged
        const originalUpdateMovesListImpl = originalUpdateMovesList;
        uiManager.updateMovesList = function() {
            const progress = trainer.getProgress().chessProgress;
            const history = trainer.chessEngine.chess.history().slice(0, progress.current);
            const historyKey = history.join(',');
            
            if (moveListCache === historyKey) {
                return; // Skip if unchanged
            }
            
            batchUpdate(() => {
                originalUpdateMovesListImpl();
                moveListCache = historyKey;
            });
        };
        
        // ============================================
        // 4. REDUCE TIMEOUT DELAYS
        // ============================================
        
        // Find and optimize existing setTimeout calls in ChessEngine
        if (trainer.chessEngine && trainer.chessEngine.handleMove) {
            const originalHandleMove = trainer.chessEngine.handleMove.bind(trainer.chessEngine);
            
            trainer.chessEngine.handleMove = function(orig, dest) {
                const result = originalHandleMove(orig, dest);
                
                // Reduce computer move delay for snappier feel
                if (this.shouldComputerMoveNow && this.shouldComputerMoveNow()) {
                    // Reduce delay from 600ms to 200ms
                    setTimeout(() => {
                        if (this.playNextComputerMove) {
                            this.playNextComputerMove();
                        }
                    }, 200); // Much faster computer responses
                }
                
                return result;
            };
        }
        
        // ============================================
        // 5. GPU ACCELERATION (SAFE CSS)
        // ============================================
        
        function addGPUAcceleration() {
            const style = document.createElement('style');
            style.textContent = `
                .cg-wrap, #board-container {
                    transform: translateZ(0);
                    will-change: transform;
                }
                
                piece {
                    transform: translateZ(0);
                    transition-duration: 0.12s !important;
                }
                
                piece.dragging {
                    will-change: transform;
                }
                
                #movesList {
                    contain: layout style paint;
                    transform: translateZ(0);
                }
                
                button:active {
                    transform: translateZ(0) scale(0.98);
                }
            `;
            document.head.appendChild(style);
        }
        
        addGPUAcceleration();
        
        // ============================================
        // 6. MEMORY CLEANUP
        // ============================================
        
        // Clean up caches periodically  
        setInterval(() => {
            if (arrowCache.size > 30) {
                arrowCache.clear();
                console.log('üßπ Arrow cache cleared');
            }
        }, 30000); // Every 30 seconds
        
        // ============================================
        // 7. PERFORMANCE MONITORING (OPTIONAL)
        // ============================================
        
        let performanceData = {
            moveCount: 0,
            totalMoveTime: 0
        };
        
        // Monitor move performance
        if (trainer.chessEngine && trainer.chessEngine.handleMove) {
            const originalMove = trainer.chessEngine.handleMove.bind(trainer.chessEngine);
            
            trainer.chessEngine.handleMove = function(orig, dest) {
                const start = performance.now();
                const result = originalMove(orig, dest);
                
                performanceData.totalMoveTime += performance.now() - start;
                performanceData.moveCount++;
                
                return result;
            };
        }
        
        // Add performance report to window (for debugging)
        window.getPerformanceReport = function() {
            const avgMoveTime = performanceData.moveCount > 0 ? 
                performanceData.totalMoveTime / performanceData.moveCount : 0;
                
            console.log(`üìä Performance Report:
    - Average move time: ${avgMoveTime.toFixed(1)}ms
    - Total moves: ${performanceData.moveCount}
    - Arrow cache size: ${arrowCache.size}
    - Memory: ${performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) + 'MB' : 'Unknown'}`);
        };
        
        // ============================================
        // SUCCESS MESSAGE
        // ============================================
        
        console.log('üéØ Performance patches applied successfully!');
        console.log('üí° Use window.getPerformanceReport() to check performance');
        
        // Visual indicator that optimizations are active
        const indicator = document.createElement('div');
        indicator.style.cssText = `
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
            z-index: 9999;
            pointer-events: none;
        `;
        indicator.textContent = 'OPTIMIZED ‚ö°';
        document.body.appendChild(indicator);
        
        // Fade out after 3 seconds
        setTimeout(() => {
            indicator.style.transition = 'opacity 1s';
            indicator.style.opacity = '0';
            setTimeout(() => indicator.remove(), 1000);
        }, 3000);
    }
    
    // Start the optimization process
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', waitForTrainer);
    } else {
        waitForTrainer();
    }
    
})();
--- engine/pgn-parser.js ---
// /engine/pgn-parser.js - Enhanced Version with Rich Move Data

/**
 * Enhanced PGN parser that provides detailed move analysis for arrow rendering
 */
export class PgnParser {
    /**
     * Takes a line object and returns an array of computed move objects with rich data
     * @param {object} line - A line object from our course JSON.
     * @returns {Array} - An array of enhanced move objects with detailed analysis
     */
    static compute(line) {
        if (typeof Chess === 'undefined') {
            console.error('FATAL: chess.js is not loaded. Parsing cannot run.');
            return [];
        }

        const computedMoves = [];
        // CRITICAL FIX: Create a new, fresh board for EACH line.
        const tempBoard = new Chess(); 
        let moveCounter = 1;

        for (let i = 0; i < line.moves.length; i++) {
            const moveNotation = line.moves[i];
            
            // Get position before the move
            const fenBefore = tempBoard.fen();
            const isWhiteTurn = tempBoard.turn() === 'w';
            
            // Try to make the move
            const moveObject = tempBoard.move(moveNotation, { sloppy: true });
            
            // This is our data validation! If a move is invalid, the entire line is considered corrupt.
            if (!moveObject) {
                console.error(`Data Validation Error in line "${line.name}": The move "${moveNotation}" is invalid from FEN: ${fenBefore}`);
                return []; // Return an empty array to prevent crashes.
            }
            
            // Get position after the move
            const fenAfter = tempBoard.fen();
            
            // Enhanced move analysis
            const enhancedMove = {
                // Basic data (existing)
                from: moveObject.from,
                to: moveObject.to,
                san: moveObject.san,
                isCapture: moveObject.flags.includes('c'),
                
                // Enhanced data (new)
                moveNumber: Math.ceil(moveCounter / 2),
                isWhiteMove: isWhiteTurn,
                piece: moveObject.piece,
                captured: moveObject.captured || null,
                promotion: moveObject.promotion || null,
                
                // Move type analysis
                moveType: this.analyzeMoveType(moveObject, moveNotation),
                flags: this.analyzeFlags(moveObject),
                
                // Positional analysis
                fenBefore: fenBefore,
                fenAfter: fenAfter,
                isCheck: moveObject.flags.includes('k'),
                isCheckmate: moveObject.flags.includes('#'),
                isCastle: moveObject.flags.includes('k') || moveObject.flags.includes('q'),
                
                // Strategic analysis
                centralControl: this.analyzesCentralControl(moveObject),
                developmentMove: this.issDevelopmentMove(moveObject, isWhiteTurn),
                tacticalThemes: this.identifyTacticalThemes(moveObject, tempBoard),
                
                // Educational metadata
                notation: moveNotation,
                index: i,
                description: this.generateMoveDescription(moveObject, moveNotation)
            };
            
            computedMoves.push(enhancedMove);
            moveCounter++;
        }
        
        console.log(`‚úÖ Enhanced parsing complete: ${computedMoves.length} moves analyzed for "${line.name}"`);
        return computedMoves;
    }
    
    /**
     * Analyze the type of move for enhanced visualization
     */
    static analyzeMoveType(moveObject, notation) {
        if (notation.includes('#')) return 'checkmate';
        if (notation.includes('+')) return 'check';
        if (notation === 'O-O') return 'castle-kingside';
        if (notation === 'O-O-O') return 'castle-queenside';
        if (moveObject.flags.includes('c')) return 'capture';
        if (moveObject.flags.includes('e')) return 'en-passant';
        if (moveObject.promotion) return 'promotion';
        if (this.issDevelopmentMove(moveObject)) return 'development';
        return 'normal';
    }
    
    /**
     * Analyze move flags for detailed information
     */
    static analyzeFlags(moveObject) {
        const flagMap = {
            'n': 'normal',
            'c': 'capture', 
            'b': 'big-pawn',
            'e': 'en-passant',
            'k': 'king-castle',
            'q': 'queen-castle',
            'p': 'promotion'
        };
        
        return moveObject.flags.split('').map(flag => flagMap[flag] || flag);
    }
    
    /**
     * Check if move controls central squares
     */
    static analyzesCentralControl(moveObject) {
        const centralSquares = ['e4', 'e5', 'd4', 'd5'];
        const extendedCenter = ['c4', 'c5', 'f4', 'f5'];
        
        const controlsCenter = centralSquares.includes(moveObject.to);
        const influencesCenter = extendedCenter.includes(moveObject.to);
        
        return {
            controlsCenter,
            influencesCenter,
            targetSquare: moveObject.to,
            centralSquares: controlsCenter ? [moveObject.to] : []
        };
    }
    
    /**
     * Determine if this is a development move
     */
    static issDevelopmentMove(moveObject, isWhiteTurn = true) {
        const piece = moveObject.piece;
        const from = moveObject.from;
        const to = moveObject.to;
        
        // Piece development from starting squares
        const whiteStartSquares = {
            'n': ['b1', 'g1'],
            'b': ['c1', 'f1'],
            'q': ['d1'],
            'r': ['a1', 'h1']
        };
        
        const blackStartSquares = {
            'n': ['b8', 'g8'],
            'b': ['c8', 'f8'], 
            'q': ['d8'],
            'r': ['a8', 'h8']
        };
        
        const startSquares = isWhiteTurn ? whiteStartSquares : blackStartSquares;
        const pieceStartSquares = startSquares[piece] || [];
        
        return pieceStartSquares.includes(from) && !pieceStartSquares.includes(to);
    }
    
    /**
     * Identify tactical themes in the move
     */
    static identifyTacticalThemes(moveObject, board) {
        const themes = [];
        
        // Check if move creates threats
        if (board.in_check()) {
            themes.push('check');
        }
        
        if (board.in_checkmate()) {
            themes.push('checkmate');
        }
        
        // Fork detection (simplified)
        if (moveObject.piece === 'n' || moveObject.piece === 'p') {
            const attacks = this.getAttackedSquares(moveObject, board);
            const importantPieces = attacks.filter(sq => {
                const piece = board.get(sq);
                return piece && ['k', 'q', 'r'].includes(piece.type);
            });
            
            if (importantPieces.length >= 2) {
                themes.push('fork');
            }
        }
        
        // Pin detection (basic)
        if (moveObject.flags.includes('c')) {
            themes.push('capture');
        }
        
        return themes;
    }
    
    /**
     * Get squares attacked by a piece (simplified)
     */
    static getAttackedSquares(moveObject, board) {
        // This is a simplified implementation
        // In a full implementation, you'd calculate actual piece attacks
        try {
            const moves = board.moves({ 
                square: moveObject.to, 
                verbose: true 
            });
            return moves.map(move => move.to);
        } catch (error) {
            return [];
        }
    }
    
    /**
     * Generate a human-readable description of the move
     */
    static generateMoveDescription(moveObject, notation) {
        const pieceNames = {
            'p': 'pawn',
            'r': 'rook', 
            'n': 'knight',
            'b': 'bishop',
            'q': 'queen',
            'k': 'king'
        };
        
        const pieceName = pieceNames[moveObject.piece];
        const fromSquare = moveObject.from;
        const toSquare = moveObject.to;
        
        let description = `${pieceName} from ${fromSquare} to ${toSquare}`;
        
        if (moveObject.flags.includes('c')) {
            const capturedPiece = pieceNames[moveObject.captured];
            description += ` captures ${capturedPiece}`;
        }
        
        if (notation.includes('+')) {
            description += ' with check';
        }
        
        if (notation.includes('#')) {
            description += ' - checkmate!';
        }
        
        if (notation === 'O-O') {
            description = 'castles kingside';
        }
        
        if (notation === 'O-O-O') {
            description = 'castles queenside';
        }
        
        return description;
    }
    
    /**
     * Validate and repair line data if possible
     */
    static validateLine(line) {
        if (!line || !line.moves || !Array.isArray(line.moves)) {
            console.warn('Invalid line data:', line);
            return false;
        }
        
        if (line.moves.length === 0) {
            console.warn('Empty move list in line:', line.name);
            return false;
        }
        
        return true;
    }
    
    /**
     * Get move statistics for a line
     */
    static getLineStatistics(computedMoves) {
        const stats = {
            totalMoves: computedMoves.length,
            captures: 0,
            checks: 0,
            castles: 0,
            developments: 0,
            centralMoves: 0,
            tacticalThemes: new Set()
        };
        
        computedMoves.forEach(move => {
            if (move.isCapture) stats.captures++;
            if (move.isCheck) stats.checks++;
            if (move.isCastle) stats.castles++;
            if (move.developmentMove) stats.developments++;
            if (move.centralControl.controlsCenter) stats.centralMoves++;
            
            move.tacticalThemes.forEach(theme => stats.tacticalThemes.add(theme));
        });
        
        stats.tacticalThemes = Array.from(stats.tacticalThemes);
        return stats;
    }
}
--- engine/spaced-repetition.js ---
// /engine/spaced-repetition.js - Complete working implementation
export class SpacedRepetitionManager {
    constructor(openingName) {
        this.openingName = openingName;
        this.cards = new Map();
        this.currentSession = {
            studied: 0,
            correct: 0,
            startTime: Date.now()
        };
    }

    createCard(positionId, data) {
        const card = {
            id: positionId,
            opening: this.openingName,
            lineIndex: data.lineIndex,
            
            interval: 1,
            repetitions: 0,
            easeFactor: 2.5,
            nextReview: Date.now(),
            
            lineCompletions: 0,
            correctTestAttempts: 0,
            totalTestAttempts: 0,
            streak: 0,
            lastStudied: null,
            currentMoveInLine: 0,
            difficulty: 'new',
            
            moves: data.moves || [],
            name: data.name,
            category: data.category,
            description: data.description,
            hint: data.hint,
            playerColor: data.playerColor || 'black',
            orientation: data.orientation || 'black'
        };
        
        this.cards.set(positionId, card);
        return card;
    }

    generateCardsFromOpening(openingData) {
        console.log('=== GENERATING SPACED REPETITION CARDS ===');
        
        if (!openingData || !openingData.lines || !openingData.lines.length) {
            console.error('ERROR: No lines in opening data');
            return;
        }

        const playerColor = openingData.playerColor || 'black';
        const orientation = openingData.orientation || 'black';
        let cardCount = 0;

        openingData.lines.forEach((line, lineIndex) => {
            if (!line.moves || !line.moves.length) {
                console.warn(`Skipping line ${lineIndex}: no moves`);
                return;
            }

            const positionId = `${this.openingName}_line${lineIndex}`;
            const cardData = {
                lineIndex: lineIndex,
                moves: line.moves,
                name: line.name,
                category: line.category || 'Main Lines',
                description: line.description || `Learn ${line.name}`,
                hint: line.hint || `Study ${line.name} variation`,
                playerColor: playerColor,
                orientation: orientation
            };

            this.createCard(positionId, cardData);
            cardCount++;
        });

        console.log(`Generated ${cardCount} cards for ${this.openingName}`);
        console.log(`Total cards available: ${this.cards.size}`);
    }

    getNextCard() {
        const allCards = Array.from(this.cards.values());
        
        if (allCards.length === 0) {
            console.log('No cards available');
            return null;
        }

        const learningCards = allCards.filter(card => card.lineCompletions < 2);
        if (learningCards.length > 0) {
            console.log(`Returning learning card: ${learningCards[0].name}`);
            return learningCards[0];
        }

        const testingCards = allCards.filter(card => card.lineCompletions >= 2);
        if (testingCards.length > 0) {
            console.log(`Returning testing card: ${testingCards[0].name}`);
            return testingCards[0];
        }

        console.log(`Returning first available card: ${allCards[0].name}`);
        return allCards[0];
    }

    updateCardAfterReview(cardId, quality) {
        const card = this.cards.get(cardId);
        if (!card) return;

        card.lastStudied = Date.now();
        this.currentSession.studied++;
        
        const isLearningPhase = card.lineCompletions < 2;
        
        if (isLearningPhase) {
            if (quality >= 3) {
                this.currentSession.correct++;
            }
        } else {
            card.totalTestAttempts++;
            
            if (quality >= 3) {
                card.correctTestAttempts++;
                card.streak++;
                this.currentSession.correct++;
                
                if (card.repetitions === 0) {
                    card.interval = 1;
                } else if (card.repetitions === 1) {
                    card.interval = 6;
                } else {
                    card.interval = Math.round(card.interval * card.easeFactor);
                }
                
                card.repetitions++;
                card.easeFactor = card.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                
                if (card.easeFactor < 1.3) {
                    card.easeFactor = 1.3;
                }
                
                card.difficulty = card.repetitions >= 2 && card.easeFactor >= 2.5 ? 'mastered' : 'testing';
            } else {
                card.streak = 0;
                card.repetitions = 0;
                card.interval = 1;
                card.difficulty = 'learning';
                card.lineCompletions = 0;
                card.currentMoveInLine = 0;
            }
            
            card.nextReview = Date.now() + (card.interval * 24 * 60 * 60 * 1000);
        }
    }

    getStats() {
        const cards = Array.from(this.cards.values());
        
        return {
            totalCards: cards.length,
            learningCards: cards.filter(c => c.lineCompletions < 2).length,
            testingCards: cards.filter(c => c.lineCompletions >= 2).length,
            masteredCards: cards.filter(c => c.difficulty === 'mastered').length,
            
            session: {
                studied: this.currentSession.studied,
                correct: this.currentSession.correct,
                successRate: this.currentSession.studied > 0 ? 
                    Math.round((this.currentSession.correct / this.currentSession.studied) * 100) : 0,
                timeMinutes: Math.round((Date.now() - this.currentSession.startTime) / 60000)
            }
        };
    }

    resetSession() {
        this.currentSession = { studied: 0, correct: 0, startTime: Date.now() };
    }

    loadProgress() {
        console.log(`Loading spaced repetition data for ${this.openingName}`);
    }

    saveProgress() {
        console.log(`Saved progress: ${this.cards.size} cards tracked`);
    }
}
--- engine/trainer-core.js ---
// /engine/trainer-core.js - FINAL CORRECTED VERSION

import { ChessEngine } from './chess-engine.js';
import { SpacedRepetitionManager } from './spaced-repetition.js';
import { PgnParser } from './pgn-parser.js';

export class ChessTrainer extends EventTarget {
    constructor(boardId, courseData, options = {}) {
        super();
        
        this.boardId = boardId;
        // --- FIX: Restore the call to the essential precomputeMoveData function ---
        this.courseData = this.precomputeMoveData(this.normalizeCourseData(courseData));
        this.options = { defaultColor: options.defaultColor || 'white', ...options };
        
        this.chessEngine = null;
        this.currentMode = 'theory';
        this.currentCategory = null;
        this.currentLineIndex = 0;
        
        this.init();
    }
    
    init() {
        this.chessEngine = new ChessEngine(this.boardId, {
            playerColor: this.options.defaultColor,
            orientation: this.courseData.orientation || this.options.defaultColor
        });
        
        this.chessEngine.onMove((move, validation) => this.handleMove(move, validation));
        this.chessEngine.onLineComplete((data) => this.emit('lineComplete', data));
        this.chessEngine.onComputerMove((move) => this.emit('computerMove', { move }));
        
        this.currentCategory = this.getDefaultCategory();
        
        this.emit('initialized', { courseData: this.courseData, mode: this.currentMode, category: this.currentCategory });
        this.loadCurrentPosition();
    }

    // --- FUNCTION RESTORED ---
    // This function is ESSENTIAL for the arrows to work.
    precomputeMoveData(courseData) {
        console.log('üéØ Processing all course lines with PgnParser...');
        if (!courseData.theory || !courseData.theory.lines) return courseData;
    
        for (const line of courseData.theory.lines) {
            // This creates the line.computedMoves property that the UI needs
            line.computedMoves = PgnParser.compute(line);
        }
        
        console.log('‚úÖ Course data processing complete.');
        return courseData;
    }
    
    normalizeCourseData(data) {
        const normalized = {
            name: data.name || 'Unnamed Course',
            playerColor: data.playerColor || 'white',
            orientation: data.orientation || data.playerColor || 'white',
            theory: null,
            exercises: null,
            spacedRepetition: null
        };
        if (data.theory) normalized.theory = data.theory;
        else if (data.lines) normalized.theory = { lines: data.lines, startingFen: data.startingFen };
        if (data.exercises) normalized.exercises = Array.isArray(data.exercises) ? 
            { lines: data.exercises } : data.exercises;
        if (data.spacedRepetition) normalized.spacedRepetition = data.spacedRepetition;
        return normalized;
    }
    
    setMode(mode) {
        this.currentMode = mode;
        this.currentLineIndex = 0;
        this.emit('modeChanged', { mode: mode, categories: this.getAvailableCategories() });
        this.loadCurrentPosition();
    }
    
    loadCurrentPosition() {
        const line = this.getCurrentLine();
        if (!line) {
            console.warn('‚ö†Ô∏è No line available');
            this.emit('error', { message: 'No line available' });
            return;
        }
        
        this.chessEngine.loadLine(line, this.getStartingFen());
        this.emit('positionLoaded', {
            mode: this.currentMode,
            line: line,
            lineIndex: this.currentLineIndex
        });
    }
    
    handleMove(move, validation) {
        if (validation.valid) {
            this.emit('correctMove', { move, validation });
        } else {
            this.emit('incorrectMove', { move, expected: validation.expected });
        }
    }
    
    nextLine() {
        const lines = this.getCurrentLines();
        if (this.currentLineIndex < lines.length - 1) {
            this.currentLineIndex++;
            this.loadCurrentPosition();
            this.emit('lineChanged', { lineIndex: this.currentLineIndex, line: this.getCurrentLine() });
        }
    }
    
    previousLine() {
        if (this.currentLineIndex > 0) {
            this.currentLineIndex--;
            this.loadCurrentPosition();
            this.emit('lineChanged', { lineIndex: this.currentLineIndex, line: this.getCurrentLine() });
        }
    }
    
    selectLine(index) {
        this.currentLineIndex = index;
        this.loadCurrentPosition();
        this.emit('lineChanged', { lineIndex: this.currentLineIndex, line: this.getCurrentLine() });
    }
    
    setCategory(category) {
        this.currentCategory = category;
        this.currentLineIndex = 0;
        this.emit('categoryChanged', { category: category, lines: this.getCurrentLines() });
        this.loadCurrentPosition();
    }
    
    resetPosition() { 
        this.chessEngine.resetCurrentLine(); 
        this.emit('positionLoaded', { line: this.getCurrentLine(), lineIndex: this.currentLineIndex });
    }
    
    flipBoard() { 
        this.chessEngine.flipBoard(); 
    }
    
    stepBackward() {
        if (this.chessEngine.stepBackward()) {
            this.emit('stepped');
        }
    }

    stepForward() {
        if (this.chessEngine.stepForward()) {
            this.emit('stepped');
        }
    }
    
    setPlayerColor(color) { 
        this.chessEngine.setPlayerColor(color);
        this.loadCurrentPosition();
    }
    
    getCurrentLine() { return this.getCurrentLines()[this.currentLineIndex] || null; }
    getCurrentLines() { return this.getCategoryLines(this.currentCategory); }
    getCategoryLines(category) {
        const allLines = this.courseData.theory?.lines || [];
        if (!category || category === 'All Categories') return allLines;
        return allLines.filter(line => line.category === category);
    }
    getAvailableCategories() {
        if (!this.courseData.theory) return [];
        const categories = [...new Set(this.courseData.theory.lines.map(line => line.category).filter(Boolean))];
        if (categories.length > 1) categories.unshift('All Categories');
        return categories;
    }
    getDefaultCategory() {
        const cats = this.getAvailableCategories();
        return cats.includes('All Categories') ? 'All Categories' : cats[0] || null;
    }
    getStartingFen() { return this.courseData.theory?.startingFen || null; }
    getProgress() {
        return {
            mode: this.currentMode,
            category: this.currentCategory,
            lineIndex: this.currentLineIndex,
            chessProgress: this.chessEngine.getLineProgress()
        };
    }
    emit(eventName, detail) { 
        this.dispatchEvent(new CustomEvent(eventName, { detail })); 
    }
}
--- engine/ui-manager.js ---
// Complete ui-manager.js with PGN annotation support
// Replace your existing ui-manager.js with this complete version

export class UIManager {
    constructor(trainer) {
        this.trainer = trainer;
        this.elements = {};
        this.config = { 
            multipleArrows: true, 
            maxMoves: 3, 
            showHints: true,
            showPgnAnnotations: true,
            showAnnotationInfo: false
        };
        this.setup();
    }
    
    setup() {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.onDomReady());
        } else { 
            this.onDomReady(); 
        }
    }
    
    onDomReady() {
        this.initializeElements();
        this.attachTrainerListeners();
        this.attachUIListeners();
        this.performInitialUpdate();
    }
    
    initializeElements() {
        this.elements = {
            modeSelect: document.getElementById('modeSelect'),
            categorySelect: document.getElementById('categorySelect'),
            lineSelect: document.getElementById('lineSelect'),
            colorSelect: document.getElementById('colorSelect'),
            prevLineBtn: document.getElementById('prevLineBtn'),
            nextLineBtn: document.getElementById('nextLineBtn'),
            resetBtn: document.getElementById('resetBtn'),
            flipBtn: document.getElementById('flipBtn'),
            status: document.getElementById('status'),
            movesList: document.getElementById('movesList'),
            successMessage: document.getElementById('successMessage'),
            errorMessage: document.getElementById('errorMessage'),
            progressFill: document.getElementById('progressFill'),
            positionInfo: document.getElementById('positionInfo'),
            moveComment: document.getElementById('moveComment'),
            backBtn: document.getElementById('backBtn'),
            forwardBtn: document.getElementById('forwardBtn')
        };
    }

    performInitialUpdate() {
        const state = this.trainer.getProgress();
        this.populateCategorySelect(this.trainer.getAvailableCategories());
        this.populateLineSelect(this.trainer.getCurrentLines());
        
        if (this.elements.modeSelect) this.elements.modeSelect.value = state.mode;
        if (this.elements.colorSelect) this.elements.colorSelect.value = this.trainer.options.defaultColor;
        if (this.elements.categorySelect) this.elements.categorySelect.value = state.category;
        if (this.elements.lineSelect) this.elements.lineSelect.value = state.lineIndex;
        
        // Enhanced configuration for PGN support
        this.config.showPgnAnnotations = true;     // Enable PGN arrows by default
        this.config.showAnnotationInfo = false;    // Set to true for debugging
        this.config.multipleArrows = true;         // Keep standard arrows enabled
        this.config.maxMoves = 3;                  // Standard arrow settings
        this.config.showHints = true;
        
        this.updatePositionInfo(this.trainer.getCurrentLine());
        this.refreshArrows();
        this.updateMovesList();
        this.updateMoveComment();
        
        // Log annotation support status
        const currentLine = this.trainer.getCurrentLine();
        if (currentLine && currentLine.annotations) {
            console.log(`üî∏ Line "${currentLine.name}" has PGN annotations:`, {
                arrows: currentLine.annotations.arrows.length,
                highlights: currentLine.annotations.highlights.length,
                comments: currentLine.annotations.comments.length
            });
        }
    }
    
    attachTrainerListeners() {
        this.trainer.addEventListener('positionLoaded', e => this.handlePositionLoaded(e.detail));
        this.trainer.addEventListener('correctMove', () => this.handleCorrectMove());
        this.trainer.addEventListener('computerMove', () => this.handleComputerMove());
        this.trainer.addEventListener('lineChanged', e => this.handleLineChanged(e.detail));
        this.trainer.addEventListener('categoryChanged', e => this.handleCategoryChanged(e.detail));
        this.trainer.addEventListener('lineComplete', e => this.handleLineComplete(e.detail));
        this.trainer.addEventListener('stepped', () => this.handleStep());
    }

    attachUIListeners() {
        if (this.elements.modeSelect) {
            this.elements.modeSelect.addEventListener('change', () => 
                this.trainer.setMode(this.elements.modeSelect.value));
        }
        if (this.elements.categorySelect) {
            this.elements.categorySelect.addEventListener('change', () => 
                this.trainer.setCategory(this.elements.categorySelect.value));
        }
        if (this.elements.lineSelect) {
            this.elements.lineSelect.addEventListener('change', () => 
                this.trainer.selectLine(parseInt(this.elements.lineSelect.value)));
        }
        if (this.elements.colorSelect) {
            this.elements.colorSelect.addEventListener('change', () => 
                this.trainer.setPlayerColor(this.elements.colorSelect.value));
        }
        if (this.elements.prevLineBtn) {
            this.elements.prevLineBtn.addEventListener('click', () => this.trainer.previousLine());
        }
        if (this.elements.nextLineBtn) {
            this.elements.nextLineBtn.addEventListener('click', () => this.trainer.nextLine());
        }
        if (this.elements.resetBtn) {
            this.elements.resetBtn.addEventListener('click', () => this.trainer.resetPosition());
        }
        if (this.elements.flipBtn) {
            this.elements.flipBtn.addEventListener('click', () => this.trainer.flipBoard());
        }
        if (this.elements.backBtn) {
            this.elements.backBtn.addEventListener('click', () => this.trainer.stepBackward());
        }
        if (this.elements.forwardBtn) {
            this.elements.forwardBtn.addEventListener('click', () => this.trainer.stepForward());
        }
    }
    
    handlePositionLoaded(data) {
        this.updatePositionInfo(data.line);
        this.updateMovesList();
        this.updateMoveComment(); 
        this.refreshArrows();
        if (this.elements.status) {
            this.elements.status.textContent = 'Ready';
            this.elements.status.classList.remove('success', 'error');
        }
    }
    
    handleCorrectMove() {
        this.clearArrows();
        this.refreshArrows();
        this.updateMovesList();
        this.updateMoveComment();
    }
    
    handleComputerMove() {
        this.updateMovesList();
        this.updateMoveComment();
        this.refreshArrows();
    }

    handleLineChanged(data) {
        this.updatePositionInfo(data.line);
        if (this.elements.lineSelect) {
            this.elements.lineSelect.value = data.lineIndex;
        }
        this.updateMovesList();
        this.updateMoveComment();
        this.refreshArrows();
        if (this.elements.status) {
            this.elements.status.textContent = 'Ready';
            this.elements.status.classList.remove('success', 'error');
        }
    }

    handleCategoryChanged(data) {
        this.populateLineSelect(data.lines);
        if (this.elements.lineSelect) {
            this.elements.lineSelect.value = 0;
        }
    }

    handleLineComplete(data) {
        if (this.elements.status) {
            this.elements.status.textContent = 'Line complete! Well done!';
            this.elements.status.classList.add('success');
        }
        if (this.elements.successMessage) {
            this.elements.successMessage.textContent = 'Line Complete!';
            this.elements.successMessage.classList.add('show');
            setTimeout(() => { 
                this.elements.successMessage.classList.remove('show'); 
            }, 3000);
        }
    }

    handleStep() {
        this.updateMovesList();
        this.updateMoveComment();
        this.refreshArrows();
    }
    
    updateMovesList() {
        if (!this.elements.movesList) return;
        
        const progress = this.trainer.getProgress().chessProgress;
        const history = this.trainer.chessEngine.chess.history().slice(0, progress.current);
        
        if (history.length > 0) {
            // OPTIMIZED: Use array join instead of string concatenation
            const moves = [];
            for (let i = 0; i < history.length; i++) {
                if (i % 2 === 0) {
                    const moveNumber = Math.floor(i / 2) + 1;
                    moves.push(`${moveNumber}.${history[i]}`);
                } else { 
                    moves.push(history[i]); 
                }
            }
            this.elements.movesList.textContent = moves.join(' ');
        } else { 
            this.elements.movesList.textContent = 'Moves will appear here...'; 
        }
    }

    updateMoveComment() {
        if (!this.elements.moveComment) return;
        
        const line = this.trainer.getCurrentLine();
        const progress = this.trainer.getProgress().chessProgress;
        const commentIndex = progress.current > 0 ? progress.current - 1 : 0;
        
        let comment = '';
        
        // Get regular comment (cleaned of annotations)
        if (line && line.comments && line.comments[commentIndex]) {
            comment = line.comments[commentIndex];
        }
        
        // Add annotation info for debugging (optional)
        if (line && line.annotations && this.config.showAnnotationInfo) {
            const arrows = line.annotations.arrows.length;
            const highlights = line.annotations.highlights.length;
            
            if (arrows > 0 || highlights > 0) {
                comment += ` [üìç${arrows} arrows, ${highlights} highlights]`;
            }
        }
        
        this.elements.moveComment.textContent = comment;
    }
    
    // COMPLETE refreshArrows method with dual arrow system:
    refreshArrows() {
        try {
            this.clearArrows();
            if (this.trainer.currentMode !== 'theory') { 
                return; 
            }
            
            const playerColor = this.trainer.chessEngine.playerColor;
            const currentTurn = this.trainer.chessEngine.getCurrentColor();
            
            const line = this.trainer.getCurrentLine();
            const progress = this.trainer.getProgress().chessProgress;
            const currentIndex = progress.current;
            
            if (!line) {
                return;
            }

            const shapes = [];
            
            // 1. Add PGN annotation arrows (DISTINCT COLORS - highest priority)
            if (line.annotations && line.annotations.arrows && this.config.showPgnAnnotations !== false) {
                const pgnArrows = this.createPgnAnnotationShapes(line, currentIndex);
                shapes.push(...pgnArrows);
                if (pgnArrows.length > 0) {
                    console.log(`üî∏ Added ${pgnArrows.length} PGN annotation arrows`);
                }
            }
            
            // 2. Add computed move arrows (STANDARD COLORS - if enabled and applicable)
            if (this.config.multipleArrows && 
                (playerColor === 'both' || playerColor === currentTurn)) {
                
                if (line.computedMoves && currentIndex < line.computedMoves.length) {
                    const moveArrows = this.createArrowShapes(line.computedMoves, currentIndex);
                    shapes.push(...moveArrows);
                    if (moveArrows.length > 0) {
                        console.log(`üéØ Added ${moveArrows.length} computed move arrows`);
                    }
                }
            }
            
            // Apply all shapes to the board
            if (shapes.length > 0) {
                this.trainer.chessEngine.board.setAutoShapes(shapes);
            }
            
        } catch (error) {
            console.error('‚ùå Arrow error:', error);
        }
    }

    // RESTORE missing createArrowShapes method (STANDARD TOOL ARROWS):
    createArrowShapes(computedMoves, startIndex) {
        const shapes = [];
        const maxMoves = Math.min(this.config.maxMoves || 3, computedMoves.length - startIndex);
        let playerMovesShown = 0;
        
        for (let i = 0; i < maxMoves; i++) {
            const move = computedMoves[startIndex + i];
            if (!move) continue;

            const isPlayerMove = this.isPlayerMove(startIndex + i);
            let color;

            if (isPlayerMove) {
                // STANDARD TOOL COLORS for computed moves
                color = playerMovesShown === 0 ? 'green' : 'yellow';
                playerMovesShown++;
            } else {
                color = 'blue'; // Computer moves are always blue
            }
            
            if (color) {
                shapes.push({ orig: move.from, dest: move.to, brush: color });
                if (move.isCapture && this.config.showHints) {
                    shapes.push({ orig: move.to, brush: 'red' });
                }
            }
        }
        return shapes;
    }

    // RESTORE missing isPlayerMove method:
    isPlayerMove(moveIndex) {
        const playerColor = this.trainer.chessEngine.playerColor;
        if (playerColor === 'both') return true;
        
        const line = this.trainer.getCurrentLine();
        if (!line || !line.computedMoves || !line.computedMoves[moveIndex]) return false;
        
        const move = line.computedMoves[moveIndex];
        const moveColor = move.isWhiteMove ? 'white' : 'black';
        
        return playerColor === moveColor;
    }

    /**
     * Create DISTINCT arrow shapes from PGN [%cal] annotations
     */
    createPgnAnnotationShapes(line, currentIndex) {
        const shapes = [];
        
        if (!line.annotations || !line.annotations.arrows) {
            return shapes;
        }
        
        // Show PGN arrows - these use DISTINCT colors from the tool arrows
        for (const arrow of line.annotations.arrows) {
            // Convert PGN annotation color to DISTINCT chessground brush
            const brush = this.mapPgnColorToBrush(arrow.color);
            
            shapes.push({
                orig: arrow.from,
                dest: arrow.to,
                brush: brush
            });
        }
        
        // Add square highlights from PGN [%csl] annotations
        if (line.annotations.highlights) {
            for (const highlight of line.annotations.highlights) {
                shapes.push({
                    orig: highlight.square,
                    brush: this.mapPgnColorToBrush(highlight.color)
                });
            }
        }
        
        return shapes;
    }

    /**
     * Map PGN annotation colors to DISTINCT chessground brush colors
     * These are DIFFERENT from the standard tool colors (green/yellow/blue)
     */
    mapPgnColorToBrush(pgnColor) {
        const colorMap = {
            'green': 'paleGreen',    // PGN green -> pale green (distinct from tool green)
            'red': 'red',            // PGN red -> red
            'yellow': 'paleBlue',    // PGN yellow -> pale blue (distinct from tool yellow)  
            'blue': 'purple',        // PGN blue -> purple (distinct from tool blue)
            'orange': 'orange'       // PGN orange -> orange (if available)
        };
        
        return colorMap[pgnColor] || 'paleGreen';
    }

    // Toggle PGN annotations:
    togglePgnAnnotations() {
        this.config.showPgnAnnotations = !this.config.showPgnAnnotations;
        this.refreshArrows();
        
        const status = this.config.showPgnAnnotations ? 'enabled' : 'disabled';
        console.log(`üî∏ PGN annotations ${status}`);
        
        // Show visual feedback
        if (this.elements.status) {
            this.elements.status.textContent = `PGN annotations ${status}`;
            this.elements.status.classList.remove('success', 'error');
            this.elements.status.classList.add('info');
            
            setTimeout(() => {
                if (this.elements.status) {
                    this.elements.status.textContent = 'Ready';
                    this.elements.status.classList.remove('info');
                }
            }, 2000);
        }
    }

    clearArrows() {
        if (this.trainer.chessEngine.board) {
            this.trainer.chessEngine.board.setAutoShapes([]);
        }
    }
    
    populateCategorySelect(categories) {
        if (this.elements.categorySelect) {
            this.elements.categorySelect.innerHTML = categories.map(cat => 
                `<option value="${cat}">${cat}</option>`).join('');
        }
    }
    
    populateLineSelect(lines) {
        if (this.elements.lineSelect) {
            this.elements.lineSelect.innerHTML = lines.map((line, idx) => 
                `<option value="${idx}">${line.name || `Line ${idx + 1}`}</option>`).join('');
        }
    }
    
    updatePositionInfo(line) {
        if (line && this.elements.positionInfo) {
            const infoContainer = this.elements.positionInfo.querySelector('div');
            if (infoContainer) {
                infoContainer.innerHTML = `<h4>${line.name || ''}</h4><p>${line.description || ''}</p>`;
            } else {
                this.elements.positionInfo.innerHTML = `
                    <div>
                        <h4>${line.name || ''}</h4>
                        <p>${line.description || ''}</p>
                    </div>
                    <p id="moveComment" style="font-style: italic; color: #aaa; margin-top: 10px;"></p>`;
            }
            this.elements.moveComment = document.getElementById('moveComment');
        }
    }
}
